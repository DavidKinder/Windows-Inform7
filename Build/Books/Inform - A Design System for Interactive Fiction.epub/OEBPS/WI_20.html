<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- Generated by indoc on 11 Aug 2016 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>Chapter 20: Advanced Text</title>
</head>
<body class="paper papertint"><p class="chapterheading">Chapter 20: Advanced Text</p>
<p class="chaptercontents"><a href="WI_20.html#s1" class="standardlink"><span class="chaptercontentsitem">§20.1. Changing texts</span></a>; <a href="WI_20.html#s2" class="standardlink"><span class="chaptercontentsitem">§20.2. Memory limitations</span></a>; <a href="WI_20.html#s3" class="standardlink"><span class="chaptercontentsitem">§20.3. Characters, words, punctuated words, unpunctuated words, lines, paragraphs</span></a>; <a href="WI_20.html#s4" class="standardlink"><span class="chaptercontentsitem">§20.4. Upper and lower case letters</span></a>; <a href="WI_20.html#s5" class="standardlink"><span class="chaptercontentsitem">§20.5. Matching and exactly matching</span></a>; <a href="WI_20.html#s6" class="standardlink"><span class="chaptercontentsitem">§20.6. Regular expression matching</span></a>; <a href="WI_20.html#s7" class="standardlink"><span class="chaptercontentsitem">§20.7. Making new text with text substitutions</span></a>; <a href="WI_20.html#s8" class="standardlink"><span class="chaptercontentsitem">§20.8. Replacements</span></a>; <a href="WI_20.html#s9" class="standardlink"><span class="chaptercontentsitem">§20.9. Summary of regular expression notation</span></a></p><table class="centredtable"><tr><td class="roadsigndirection"><a href="WI_1.html" class="standardlink"><img alt="arrow-up-left.png" src="images/arrow-up-left.png" /></a></td><td><a href="WI_1.html" class="standardlink">Contents of <i>Writing with Inform</i></a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_19.html" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_19.html" class="standardlink">Chapter 19: Rulebooks</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_21.html" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_21.html" class="standardlink">Chapter 21: Lists</a></td></tr>
<tr><td class="roadsigndirection"><a href="examples_alphabetical.html" class="standardlink"><img alt="arrow-down-right.png" src="images/arrow-down-right.png" /></a></td><td><a href="examples_alphabetical.html" class="standardlink">Indexes of the examples</a></td></tr>
</table><p class="sectionheading"><a id="s1"></a>§20.1. Changing texts</p>
<p>So far, we have dealt with text as something which comes in little packets: we have printed it out, read it in from the keyboard, and compared it with other text. But we have never tried to open the packets and get at the contents, letter by letter, or to make any alterations, or look for certain combinations of letters. These tricks are surprisingly seldom needed - a surprise, that is, given that everything Inform does is textual - but they are in fact open to us. For example:</p>
<!-- START CODE "c8095" -->
<a id="c8095"></a><blockquote class="code"><p class="quoted">
if character number 1 in &quot;[time of day]&quot; is &quot;1&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>will be true at, for example, 11:30 PM and 1:22 AM, but not at 3:15 PM. What happens here is that Inform expands the time of day into a text, say &quot;11:30 PM&quot;, then extracts the first character, say &quot;1&quot;, and tests it.</p>
<p>Until 2012, Inform had two kinds of text - plain &quot;text&quot;, and &quot;indexed text&quot; - but there's now only &quot;text&quot;, which has all of the abilities of both.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_19.html#s16" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_19.html#s16" class="standardlink">Back to Chapter 19: Rulebooks: §19.16. The Laws for Sorting Rulebooks</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s2" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s2" class="standardlink">Onward to §20.2. Memory limitations</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s2"></a>§20.2. Memory limitations</p>
<p>Inform creates &quot;story files&quot; for very small virtual computers (capable of running on phones, for instance) where memory is tight. If we create a number variable and keep on adding 1 to it, the value simply gets bigger. But if we make some text and keep on adding a letter &quot;x&quot; to it, the text takes up more and more space, growing into longer and longer runs of &quot;x&quot;s until there is no more space to hold it.</p>
<p>The following warnings are rather like the tiny print about side-effects on medicine bottles: that is, we mostly ignore them, and if the drugs should kill us, well, at least we have the consolation of knowing we were warned. There are basically three limitations on text:</p>
<p>(1) An amount of memory has to be set aside for text (and other flexible-sized data), and Inform guesses the amount needed. Story files using the Glulx format (see the Settings panel) are able to increase this as necessary in play, so there's no problem if the guess was wrong. But Z-machine story files are stuck with whatever amount of memory was initially chosen.</p>
<p>That choice can be increased with a use option, like so:</p>
<!-- START CODE "c8096" -->
<a id="c8096"></a><blockquote class="code"><p class="quoted">
Use dynamic memory allocation of at least 16384.
</p></blockquote>
<!-- END CODE -->
<p>Inform raises its estimate of the amount needed to ensure that this amount is always at least its own guess, and also at least any amount declared like this. (And then it rounds up to the nearest power of 2, as it happens.) The default value of &quot;dynamic memory allocation&quot; is 8192. In practice, this use option isn't needed much, though, because any story needing large amounts of dynamic memory will likely be on Glulx in any case.</p>
<p>(2) Text has a maximum length. This maximum is normally 1000 characters, which ought to be plenty, but can be raised by sentences such as:</p>
<!-- START CODE "c8097" -->
<a id="c8097"></a><blockquote class="code"><p class="quoted">
Use maximum text length of at least 2000.
</p></blockquote>
<!-- END CODE -->
<p>What happens if this is broken, that is, if we try to use text overrunning this length? The Z-machine may simply crash, so if there is any chance that any single text may grow unpredictably large, Glulx should always be used. On Glulx, overrunning text is truncated safely, except that under Glulx 3.1.0 or better the story file will try to use dynamic memory allocation to expand the limit as needed to avoid truncation. (Testing shows that text is slow to manipulate once it grows beyond about 20,000 characters in length, but this is not really surprising.)</p>
<p>(3) Under the Z-machine, text may only contain characters from the so-called &quot;ZSCII&quot; character set - standard numbers, letters, punctuation marks and the commonest West European accented letters. Anything more exotic is likely to be flattened into a question mark &quot;?&quot;. Under Glulx, any character can be used.</p>
<p>All of this makes the Z-machine sound very inferior, for text purposes. But note that Z can handle all of the examples in this chapter perfectly happily.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s1" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s1" class="standardlink">Back to §20.1. Changing texts</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s3" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s3" class="standardlink">Onward to §20.3. Characters, words, punctuated words, unpunctuated words, lines, paragraphs</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s3"></a>§20.3. Characters, words, punctuated words, unpunctuated words, lines, paragraphs</p>
<p>Inform can get at the contents of text in a variety of ways. The lowest-level is by character - a character is a letter, digit, punctuation symbol, space or other letter-form. (We use the term &quot;character&quot; rather than &quot;letter&quot; because otherwise we would have to call &quot;5&quot; a letter, and so on.) Characters number upwards from 1: character number 1, to repeat that, starts the text. We can get the Nth character with:</p>
<!-- START PHRASE "defn287" -->
<div class="definition"><a id="defn287"></a><p class="defnprototype"><b>character number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_charnum -->

<p>This phrase produces the Nth character from the text, counting from 1. Characters include letters, digits, punctuation symbols, spaces or other letter-forms. Example:</p>
<!-- START CODE "c8098" -->
<a id="c8098"></a><blockquote class="code"><p class="quoted">
character number 8 in &quot;numberless projects of social reform&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;e&quot;. If the index is less than 1 or more than the length of the text, the result is an empty text, &quot;&quot;.</p>

<!-- end definition -->
</div>

<p>The maximum character number varies with the current length of the text, and can be evaluated as:</p>
<!-- START PHRASE "defn288" -->
<div class="definition"><a id="defn288"></a><p class="defnprototype"><b>number of characters in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numchars -->

<p>This phrase produces the number of characters from the text. Characters include letters, digits, punctuation symbols, spaces or other letter-forms. Examples:</p>
<!-- START CODE "c8099" -->
<a id="c8099"></a><blockquote class="code"><p class="quoted">
number of characters in &quot;War and Peace&quot;
<br />number of characters in &quot;&quot;
</p></blockquote>
<!-- END CODE -->
<p>produce 13 and 0 respectively.</p>

<!-- end definition -->
</div>

<p>We can also use the adjective &quot;empty&quot;:</p>
<!-- START CODE "c8100" -->
<a id="c8100"></a><blockquote class="code"><p class="quoted">
if the description of the location is empty, ...
</p></blockquote>
<!-- END CODE -->
<p>The empty text, &quot;&quot;, is the only one with 0 characters.</p>
<p>We can also extract the contents by word, again numbered from 1. Thus:</p>
<!-- START PHRASE "defn289" -->
<div class="definition"><a id="defn289"></a><p class="defnprototype"><b>word number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_wordnum -->

<p>This phrase produces the Nth word from the text, counting from 1. Words for this purpose are what's left after breaking the text up at punctuation or spacing (spaces, line breaks, paragraph breaks) and then removing that punctuation or spacing. Example:</p>
<!-- START CODE "c8101" -->
<a id="c8101"></a><blockquote class="code"><p class="quoted">
word number 3 in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;don't&quot;. If the index is less than 1 or more than the number of words in the text, the result is an empty text, &quot;&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn290" -->
<div class="definition"><a id="defn290"></a><p class="defnprototype"><b>number of words in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numwords -->

<p>This phrase produces the number of words from the text. Words for this purpose are what's left after breaking the text up at punctuation or spacing (spaces, line breaks, paragraph breaks) and then removing that punctuation or spacing. Example:</p>
<!-- START CODE "c8102" -->
<a id="c8102"></a><blockquote class="code"><p class="quoted">
number of words in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces 5.</p>

<!-- end definition -->
</div>

<p>Note that the contraction apostrophe in &quot;don't&quot; doesn't count as punctuation. Because this is not always quite what we want, Inform offers two variations:</p>
<!-- START PHRASE "defn291" -->
<div class="definition"><a id="defn291"></a><p class="defnprototype"><b>punctuated word number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_pwordnum -->

<p>This phrase produces the Nth word from the text, counting from 1. Words for this purpose are what's left after breaking the text up at punctuation or spacing (spaces, line breaks, paragraph breaks) and then removing the spacing, but leaving the punctuation as independent words. Example:</p>
<!-- START CODE "c8103" -->
<a id="c8103"></a><blockquote class="code"><p class="quoted">
punctuated word number 2 in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;-&quot;. The punctuated words here are &quot;ice&quot;, &quot;-&quot;, &quot;hot&quot;, &quot;,&quot;, &quot;don't&quot;, &quot;you&quot;, &quot;think&quot;, &quot;?&quot;. If two or more punctuation marks are adjacent, they are counted as different words, except for runs of dashes or periods: thus &quot;,,&quot; has two punctuated words, but &quot;--&quot; and &quot;...&quot; have only one each. If the index is less than 1 or more than the number of punctuated words in the text, the result is an empty text, &quot;&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn292" -->
<div class="definition"><a id="defn292"></a><p class="defnprototype"><b>number of punctuated words in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numpwords -->

<p>This phrase produces the number of words from the text. Words for this purpose are what's left after breaking the text up at punctuation or spacing (spaces, line breaks, paragraph breaks) and then removing the spacing, but leaving the punctuation as independent words. Example:</p>
<!-- START CODE "c8104" -->
<a id="c8104"></a><blockquote class="code"><p class="quoted">
number of punctuated words in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces 8; see if you can find them all.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn293" -->
<div class="definition"><a id="defn293"></a><p class="defnprototype"><b>unpunctuated word number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_upwordnum -->

<p>This phrase produces the Nth word from the text, counting from 1. Words for this purpose are what's left after breaking the text up at spacing (spaces, line breaks, paragraph breaks) but including all punctuation as if it were part of the spelling of the words it joins to. Example:</p>
<!-- START CODE "c8105" -->
<a id="c8105"></a><blockquote class="code"><p class="quoted">
unpunctuated word number 1 in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;ice-hot,&quot;. The unpunctuated words in &quot;ice-hot, don't you think?&quot; are &quot;ice-hot,&quot;, &quot;don't&quot;, &quot;you&quot;, &quot;think?&quot;. If the index is less than 1 or more than the number of punctuated words in the text, the result is an empty text, &quot;&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn294" -->
<div class="definition"><a id="defn294"></a><p class="defnprototype"><b>number of unpunctuated words in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numupwords -->

<p>This phrase produces the number of words from the text. Words for this purpose are what's left after breaking the text up at spacing (spaces, line breaks, paragraph breaks) but including all punctuation as if it were part of the spelling of the words it joins to. Example:</p>
<!-- START CODE "c8106" -->
<a id="c8106"></a><blockquote class="code"><p class="quoted">
number of unpunctuated words in &quot;ice-hot, don't you think?&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces just 4.</p>

<!-- end definition -->
</div>

<p>Finally, on the larger scale still, we also have:</p>
<!-- START PHRASE "defn295" -->
<div class="definition"><a id="defn295"></a><p class="defnprototype"><b>line number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_linenum -->

<p>This phrase produces the Nth line from the text, counting from 1. Unless explicit use is made of line-breaking, lines and paragraphs will be the same - it doesn't refer to lines as visible on screen, because we have no way of knowing what size screen the player might have.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn296" -->
<div class="definition"><a id="defn296"></a><p class="defnprototype"><b>number of lines in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numlines -->

<p>This phrase produces the number of lines in the text. Unless explicit use is made of line-breaking, lines and paragraphs will be the same - it doesn't refer to lines as visible on screen, because we have no way of knowing what size screen the player might have. Example: the number of lines in</p>
<!-- START CODE "c8107" -->
<a id="c8107"></a><blockquote class="code"><p class="quoted">
&quot;Sensational news just in![paragraph break]The Martians have invaded Miranda.[line break](One of the moons of Uranus, that is.)&quot;
</p></blockquote>
<!-- END CODE -->
<p>is 3.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn297" -->
<div class="definition"><a id="defn297"></a><p class="defnprototype"><b>paragraph number </b>(number)<b> in </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_paranum -->

<p>This phrase produces the Nth paragraph from the text, counting from 1.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn298" -->
<div class="definition"><a id="defn298"></a><p class="defnprototype"><b>number of paragraphs in </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_numparas -->

<p>This phrase produces the number of paragraphs in the text. Example: the number of paragraphs in</p>
<!-- START CODE "c8108" -->
<a id="c8108"></a><blockquote class="code"><p class="quoted">
&quot;Sensational news just in![paragraph break]The Martians have invaded Miranda.[line break](One of the moons of Uranus, that is.)&quot;
</p></blockquote>
<!-- END CODE -->
<p>is 2.</p>

<!-- end definition -->
</div>

<p>(Attempting to make large enough texts to have a serious paragraph count is slightly risky if there is not much memory to play with, as on the Z-machine. But the facilities do exist.)</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s2" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s2" class="standardlink">Back to §20.2. Memory limitations</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s4" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s4" class="standardlink">Onward to §20.4. Upper and lower case letters</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s4"></a>§20.4. Upper and lower case letters</p>
<p>In most European languages the same letters can appear in two forms: as capitals, like &quot;X&quot;, mainly used to mark a name or the start of a sentence; or in their ordinary less prominent form, like &quot;x&quot;. These forms are called upper and lower case because, historically, typesetters kept lead castings of letters in two wooden cases, one above the other on the workbench. Lower case letters were in the lower box closer to hand, being more often needed.</p>
<p>Human languages are complicated. Not every lower case letter has an upper case partner: ordinal markers in Hispanic languages don't, for instance, and the German &quot;ß&quot; is never used in upper case. Sometimes two different lower case letters have the same upper case form: &quot;ς&quot; and &quot;σ&quot;, two versions of the Greek sigma, both capitalise to &quot;Σ&quot;. Inform follows the international Unicode standard in coping with all this.</p>
<p>We can test whether text is in either case like so:</p>
<!-- START PHRASE "defn299" -->
<div class="definition"><a id="defn299"></a><p class="defnprototype"><b>if </b>(text)<b> is in lower case:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_inlower -->

<p>This condition is true if every character in the text is a lower case letter. Examples: this is true for &quot;wax&quot;, but false for &quot;wax seal&quot; or &quot;eZ mOnEy&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn300" -->
<div class="definition"><a id="defn300"></a><p class="defnprototype"><b>if </b>(text)<b> is in upper case:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_inupper -->

<p>This condition is true if every character in the text is in upper case. Examples: this is true for &quot;BEESWAX&quot;, but false for &quot;ROOM 101&quot;.</p>

<!-- end definition -->
</div>

<p>We can change the casing of text using:</p>
<!-- START PHRASE "defn301" -->
<div class="definition"><a id="defn301"></a><p class="defnprototype"><b></b>(text)<b> in lower case ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_lowercase -->

<p>This phrase produces a new version of the given text, but with all upper case letters reduced to lower case. Example: &quot;a ticket to Tromsø via Østfold&quot; becomes</p>
<!-- START CODE "c8109" -->
<a id="c8109"></a><blockquote class="code"><p class="quoted">
&quot;a ticket to tromsø via østfold&quot;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn302" -->
<div class="definition"><a id="defn302"></a><p class="defnprototype"><b></b>(text)<b> in upper case ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_uppercase -->

<p>This phrase produces a new version of the given text, but with all upper case letters reduced to lower case. Example: &quot;a ticket to Tromsø via Østfold&quot; becomes</p>
<!-- START CODE "c8110" -->
<a id="c8110"></a><blockquote class="code"><p class="quoted">
&quot;A TICKET TO TROMSØ VIA ØSTFOLD&quot;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn303" -->
<div class="definition"><a id="defn303"></a><p class="defnprototype"><b></b>(text)<b> in title case ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_titlecase -->

<p>This phrase produces a new version of the given text, but with casing of words changed to title casing: this capitalises the first letter of each word, and lowers the rest. Example: &quot;a ticket to Tromsø via Østfold&quot; becomes</p>
<!-- START CODE "c8111" -->
<a id="c8111"></a><blockquote class="code"><p class="quoted">
&quot;A Ticket To Tromsø Via Østfold&quot;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn304" -->
<div class="definition"><a id="defn304"></a><p class="defnprototype"><b></b>(text)<b> in sentence case ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_sentencecase -->

<p>This phrase produces a new version of the given text, but with casing of words changed to sentence casing: this capitalises the first letter of each sentence and reduces the rest to lower case. Example: &quot;a ticket to Tromsø via Østfold&quot; becomes</p>
<!-- START CODE "c8112" -->
<a id="c8112"></a><blockquote class="code"><p class="quoted">
&quot;A ticket to tromsø via østfold&quot;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>Accents are preserved in case changes. So (if we are using Glulx and have Unicode available) title case can turn Aristophanes' discomfortingly lower-case lines</p>
<!-- START CODE "c8113" -->
<a id="c8113"></a><blockquote class="code"><p class="quoted">
ἐξ οὗ γὰρ ἡμᾶς προὔδοσαν μιλήσιοι,
<br />οὐκ εἶδον οὐδ᾽ ὄλισβον ὀκτωδάκτυλον,
<br />ὃς ἦν ἂν ἡμῖν σκυτίνη &quot;πικουρία
</p></blockquote>
<!-- END CODE -->
<p>by raising them proudly up like so:</p>
<!-- START CODE "c8114" -->
<a id="c8114"></a><blockquote class="code"><p class="quoted">
Ἐξ Οὗ Γὰρ Ἡμᾶς Προὔδοσαν Μιλήσιοι,
<br />Οὐκ Εἶδον Οὐδ᾽ Ὄλισβον Ὀκτωδάκτυλον,
<br />Ὃς Ἦν Ἂν Ἡμῖν Σκυτίνη &quot;Πικουρία.
</p></blockquote>
<!-- END CODE -->
<p>Title and sentence casing can only be approximate if done by computer. Inform looks at the letters, but is blind to the words and sentences they make up. (Note the way sentence casing did not realise &quot;Tromsø&quot; and &quot;Østfold&quot; were proper nouns.) If asked to put the name &quot;MCKAY&quot; into title casing, Inform will opt for &quot;Mckay&quot;, not recognising this as the Scottish patronymic surname &quot;McKay&quot;. Given &quot;baym dnieper&quot;, the title of David Bergelson's great Yiddish novel of 1932, it will opt for &quot;BAYM DNIEPER&quot;: but properly speaking Yiddish does not have upper case lettering at all, though nowadays it is sometimes printed as if it did. And conventions are very variable about which words should be capitalised in titles: English publishers mostly agree that connectives, articles and prepositions should be in lower case, but in France almost anything goes, with Académie Française rules giving way to avant-garde book design. In short, we cannot rely on Inform's title casing to produce a result which a human reader will always think perfect.</p>
<p>This discussion has all been about how Inform prints, not about how it reads commands from the keyboard, because the latter is done case-insensitively. The virtual machines for which Inform creates programs normally flatten all command input to lower case, and in any case Understand comparison ignores casing. Thus</p>
<!-- START CODE "c8115" -->
<a id="c8115"></a><blockquote class="code"><p class="quoted">
Understand &quot;mckay&quot; as the Highland Piper.
</p></blockquote>
<!-- END CODE -->
<p>means that &quot;examine McKay&quot;, &quot;examine MCKAY&quot;, &quot;examine mckay&quot;, and so forth are all equivalent. The text of the player's command probably doesn't preserve the original casing typed in any event.</p>
<p>One more caution, though it will affect hardly anyone. For projects using the Z-machine, only a restricted character set is available in texts: for more, we must use Glulx. A mad anomaly of ZSCII, the Z-machine character set, is that it contains the lower case letter &quot;ÿ&quot; but not its upper case form &quot;Ÿ&quot;, so that</p>
<!-- START CODE "c8116" -->
<a id="c8116"></a><blockquote class="code"><p class="quoted">
&quot;ÿ&quot; in upper case
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;Ÿ&quot; in Glulx but &quot;ÿ&quot; in the Z-machine. This will come as a blow to Queensrÿche fans, but in all other respects any result on the Z-machine should agree with its counterpart on Glulx.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s3" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s3" class="standardlink">Back to §20.3. Characters, words, punctuated words, unpunctuated words, lines, paragraphs</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s5" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s5" class="standardlink">Onward to §20.5. Matching and exactly matching</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e63" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e63" class="standardlink">Example 412: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Capital City</b>&#160;&#160;&#160; To arrange that the location information normally given on the left-hand side of the status line appears in block capitals.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e328" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e328" class="standardlink">Example 413: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Rocket Man</b>&#160;&#160;&#160; Using case changes on any text produced by a "to say..." phrase.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s5"></a>§20.5. Matching and exactly matching</p>
<p>Up to now, we have only been able to judge two texts by seeing if they are equal, but we can now ask more subtle questions.</p>
<!-- START PHRASE "defn305" -->
<div class="definition"><a id="defn305"></a><p class="defnprototype"><b>if </b>(text)<b> matches the text </b>(text)<b>:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_matches -->

<p>This condition is true if the second text occurs anywhere inside the first. Examples:</p>
<!-- START CODE "c8117" -->
<a id="c8117"></a><blockquote class="code"><p class="quoted">
if &quot;[score]&quot; matches the text &quot;3&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>tests whether the digit 3 occurs anywhere in the score, as printed out; and</p>
<!-- START CODE "c8118" -->
<a id="c8118"></a><blockquote class="code"><p class="quoted">
if the printed name of the location matches the text &quot;the&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>tests to see whether &quot;the&quot; can be found anywhere in the current room's name. Note that the location &quot;Smotheringly Hot Jungle&quot; would pass this test - it's there if you look. On the other hand, &quot;The Orangery&quot; would not, because &quot;The&quot; does not match against &quot;the&quot;. We can get around this in a variety of ways, one of which is to tell Inform to be insensitive to the case (upper or lower) of letters:</p>
<!-- START CODE "c8119" -->
<a id="c8119"></a><blockquote class="code"><p class="quoted">
if the printed name of the location matches the text &quot;the&quot;, case insensitively: ...
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn306" -->
<div class="definition"><a id="defn306"></a><p class="defnprototype"><b>if </b>(text)<b> exactly matches the text </b>(text)<b>:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_exactlymatches -->

<p>This condition is true if the second text matches the first, starting at the beginning and finishing at the end. This appears to be the same as testing if one is equal to the other, but that's not quite true: for example,</p>
<!-- START CODE "c8120" -->
<a id="c8120"></a><blockquote class="code"><p class="quoted">
if &quot;[score]&quot; exactly matches the text &quot;[best score]&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>is true if the score and best score currently print out as the same text, which will be true if they are currently equal as numbers; but</p>
<!-- START CODE "c8121" -->
<a id="c8121"></a><blockquote class="code"><p class="quoted">
if &quot;[score]&quot; is &quot;[best score]&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>is never true - these are different texts, even if they sometimes look the same.</p>

<!-- end definition -->
</div>

<p>In the next section we shall see that &quot;matches&quot; and &quot;exactly matches&quot; can do much more than the simple text matching demonstrated above.</p>
<p>We can also see how many times something matches:</p>
<!-- START PHRASE "defn307" -->
<div class="definition"><a id="defn307"></a><p class="defnprototype"><b>number of times </b>(text)<b> matches the text </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_nummatches -->

<p>This produces the number of times the second text occurs within the first. The matches are not allowed to overlap. Example:</p>
<!-- START CODE "c8122" -->
<a id="c8122"></a><blockquote class="code"><p class="quoted">
number of times &quot;pell-mell sally&quot; matches the text &quot;ll&quot; = 3
<br />number of times &quot;xyzzy&quot; matches the text &quot;Z&quot; = 0
<br />number of times &quot;xyzzy&quot; matches the text &quot;Z&quot;, case insensitively = 2
<br />number of times &quot;aaaaaaaa&quot; matches the text &quot;aaaa&quot; = 2
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>There's no &quot;number of times WHATEVER exactly matches the text FIND&quot; phrase since this is by definition going to have to be 0 or 1.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s4" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s4" class="standardlink">Back to §20.4. Upper and lower case letters</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s6" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s6" class="standardlink">Onward to §20.6. Regular expression matching</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s6"></a>§20.6. Regular expression matching</p>
<p>When playing around with text, we tend to get into longer and trickier wrangles of matching - we find that we want to look not for simple text like &quot;gold&quot;, but for &quot;gold&quot; used only as a separate word, or for a date in YYYY-MM-DD format, or for a seemingly endless range of other possibilities. What we need is not just for Inform to provide a highly flexible matching program, but also a good notation in which to describe what we want.</p>
<p>Fortunately, such a notation already exists. This is the &quot;regular expression&quot; notation, named for a 1950s mathematical model by the logician Stephen Kleene, applied to computing in the late 60s by Ken Thompson, borrowed almost at once by the early Unix tools of the 70s, and developed further by Henry Spencer in the 80s and Philip Hazel in the 90s. The glue holding the Internet together - the Apache web-server, the scripting languages Perl and Python, and so forth - makes indispensable use of regular expressions.</p>
<p>As might be expected from the previous section, we simply have to describe the FIND text as &quot;regular expression&quot; rather than &quot;text&quot; and then the same facilities are available:</p>
<!-- START PHRASE "defn308" -->
<div class="definition"><a id="defn308"></a><p class="defnprototype"><b>if </b>(text)<b> matches the regular expression </b>(text)<b>:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_matchesre -->

<p>This condition is true if any contiguous part of the text can be matched against the given regular expression. Examples:</p>
<!-- START CODE "c8123" -->
<a id="c8123"></a><blockquote class="code"><p class="quoted">
if &quot;taramasalata&quot; matches the regular expression &quot;a.*l&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>is true, since this looks for a part of &quot;taramasalata&quot; which begins with &quot;a&quot;, continues with any number of characters, and finishes with &quot;l&quot;; so it matches &quot;aramasal&quot;. (Not &quot;asal&quot;, because it gets the makes the leftmost match it can.) The option &quot;case insensitively&quot; causes lower and upper case letters to be treated as equivalent.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn309" -->
<div class="definition"><a id="defn309"></a><p class="defnprototype"><b>if </b>(text)<b> exactly matches the regular expression </b>(text)<b>:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_exactlymatchesre -->

<p>This condition is true if the whole text (starting from the beginning and finishing at the end) can be matched against the given regular expression. The option &quot;case insensitively&quot; causes lower and upper case letters to be treated as equivalent.</p>

<!-- end definition -->
</div>

<p>And once again:</p>
<!-- START PHRASE "defn310" -->
<div class="definition"><a id="defn310"></a><p class="defnprototype"><b>number of times </b>(text)<b> matches the regular expression </b>(text)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_nummatchesre -->

<p>This produces the number of times that contiguous pieces of the text can be matched against the regular expression, without allowing them to overlap.</p>

<!-- end definition -->
</div>

<p>Since a regular expression can match quite a variety of possibilities (for instance &quot;b\w+t&quot; could match &quot;boast&quot;, &quot;boat&quot;, &quot;bonnet&quot; and so on), it's sometimes useful to find what the match actually was:</p>
<!-- START PHRASE "defn311" -->
<div class="definition"><a id="defn311"></a><p class="defnprototype"><b>text matching regular expression ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_matchtext -->

<p>This phrase is only meaningful immediately after a successful match of a regular expression against text, and it produces the text which matched. Example:</p>
<!-- START CODE "c8124" -->
<a id="c8124"></a><blockquote class="code"><p class="quoted">
if &quot;taramasalata&quot; matches the regular expression &quot;m.*l&quot;:
<br />&#160;&#160;&#160;&#160;say &quot;[text matching regular expression].&quot;;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;masal.&quot;</p>

<!-- end definition -->
</div>

<p>Perhaps fairly, perhaps not, regular expressions have a reputation for being inscrutable. The basic idea is that although alphanumeric characters (letters, numbers and spaces) mean just what they look like, punctuation characters are commands with sometimes dramatic effects. Thus:</p>
<!-- START CODE "c8125" -->
<a id="c8125"></a><blockquote class="code"><p class="quoted">
if WHATEVER matches the regular expression &quot;fish&quot;, ...
<br />if WHATEVER matches the regular expression &quot;f.*h&quot;, ...
</p></blockquote>
<!-- END CODE -->
<p>behave very differently. The first is just like matching the text &quot;fish&quot;, but the second matches on any sequence of characters starting with an &quot;f&quot; and ending with an &quot;h&quot;. This is not at all obvious at first sight: reading regular expressions is a skill which must be learned, like reading a musical score. A really complex regular expression can look like a soup of punctuation and even an expert will blink for a few minutes before telling you what it does - but a beginner can pick up the basics very quickly. Newcomers might like to try out and become comfortable with the features a few at a time, reading down the following list.</p>
<p><span class="boldface">1. Golden rule</span>. Don't try to remember all the characters with weird effects. Instead, if you actually mean any symbol other than a letter, digit or space to be taken literally, place a backslash &quot;\&quot; in front of it. For instance, matching the regular expression</p>
<!-- START CODE "c8126" -->
<a id="c8126"></a><blockquote class="code"><p class="quoted">
&quot;\*A\* of the Galactic Patrol&quot;
</p></blockquote>
<!-- END CODE -->
<p>is the same as matching the text &quot;*A* of the Galactic Patrol&quot;, because the asterisks are robbed of their normal powers. This includes backslash itself: &quot;\\&quot; means a literal backslash. (Don't backslash letters or digits - that turns out to have a meaning all its own, but anyway, there is never any need.)</p>
<p><span class="boldface">2. Alternatives</span>. The vertical stroke &quot;|&quot; - not a letter I or L, nor the digit 1 - divides alternatives. Thus</p>
<!-- START CODE "c8127" -->
<a id="c8127"></a><blockquote class="code"><p class="quoted">
&quot;the fish|fowl|crawling thing&quot;
</p></blockquote>
<!-- END CODE -->
<p>is the same as saying match &quot;the fish&quot;, or &quot;fowl&quot;, or &quot;crawling thing&quot;.</p>
<p><span class="boldface">3. Dividing with brackets</span>. Round brackets &quot;(&quot; and &quot;)&quot; group parts of the expression together.</p>
<!-- START CODE "c8128" -->
<a id="c8128"></a><blockquote class="code"><p class="quoted">
&quot;the (fish|fowl|crawling thing) in question&quot;
</p></blockquote>
<!-- END CODE -->
<p>is the same as saying match &quot;the fish in question&quot;, or &quot;the fowl in question&quot;, or &quot;the crawling thing in question&quot;. Note that the &quot;|&quot; ranges outwards only as far as the group it is in.</p>
<p><span class="boldface">4. Any character</span>. The period &quot;.&quot; means any single character. So</p>
<!-- START CODE "c8129" -->
<a id="c8129"></a><blockquote class="code"><p class="quoted">
&quot;a...z&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches on any sequence of five characters so long as the first is &quot;a&quot; and the last is &quot;z&quot;.</p>
<p><span class="boldface">5. Character alternatives</span>. The angle brackets &quot;&lt;&quot; and &quot;&gt;&quot; are a more concise way of specifying alternatives for a single character. Thus</p>
<!-- START CODE "c8130" -->
<a id="c8130"></a><blockquote class="code"><p class="quoted">
&quot;b&lt;aeiou&gt;b&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches on &quot;bab&quot;, &quot;beb&quot;, &quot;bib&quot;, &quot;bob&quot; or &quot;bub&quot;, but not &quot;baob&quot; or &quot;beeb&quot; - any single character within the angle brackets is accepted. Beginning the range with &quot;^&quot; means &quot;any single character so long as it is not one of these&quot;: thus</p>
<!-- START CODE "c8131" -->
<a id="c8131"></a><blockquote class="code"><p class="quoted">
&quot;b&lt;^aeiou&gt;b&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches on &quot;blb&quot; but not &quot;bab&quot;, &quot;beb&quot;, etc., nor on &quot;blob&quot; or &quot;bb&quot;. Because long runs like this can be a little tiresome, we are also allowed to use &quot;-&quot; to indicate whole ranges. Thus</p>
<!-- START CODE "c8132" -->
<a id="c8132"></a><blockquote class="code"><p class="quoted">
&quot;b&lt;a-z&gt;b&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches a &quot;b&quot;, then any lower case English letter, then another &quot;b&quot;.</p>
<p>In traditional regular expression language, square brackets rather than angle brackets are used for character ranges. In fact Inform does understand this notation if there are actual square brackets &quot;[&quot; and &quot;]&quot; in the pattern text, but in practice this would be tiresome to achieve, since Inform uses those to achieve text substitutions. So Inform allows &quot;b&lt;a-z&gt;b&quot; rather than making us type something like</p>
<!-- START CODE "c8133" -->
<a id="c8133"></a><blockquote class="code"><p class="quoted">
&quot;b[bracket]a-z[close bracket]b&quot;
</p></blockquote>
<!-- END CODE -->
<p>to create the text &quot;b[a-z]b&quot;.</p>
<p><span class="boldface">6. Popular character ranges</span>. The range &quot;&lt;0-9&gt;&quot;, matching any decimal digit, is needed so often that it has an abbreviation: &quot;\d&quot;. Thus</p>
<!-- START CODE "c8134" -->
<a id="c8134"></a><blockquote class="code"><p class="quoted">
&quot;\d\d\d\d-\d\d-\d\d&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches, say, &quot;2006-12-03&quot;. Similarly, &quot;\s&quot; means &quot;any spacing character&quot; - a space, tab or line break. &quot;\p&quot; is a punctuation character, in the same sense used for word division in the previous section: it actually matches any of</p>
<!-- START CODE "c8135" -->
<a id="c8135"></a><blockquote class="code"><p class="quoted">
. , ! ? - / &quot; : ; ( ) [ ] { }
</p></blockquote>
<!-- END CODE -->
<p>&quot;\w&quot; means &quot;any character appearing in a word&quot;, and Inform defines it as anything not matching &quot;\s&quot; or &quot;\p&quot;.</p>
<p>&quot;\l&quot; and &quot;\u&quot; match lower and upper case letters, respectively. These are much stronger than &quot;&lt;a-z&gt;&quot; and &quot;&lt;A-Z&gt;&quot;, since they use the complete definition in the Unicode 4.0.0 standard, so that letter-forms from all languages are catered for: for example &quot;δ&quot; matches &quot;\l&quot; and &quot;Δ&quot; matches &quot;\u&quot;.</p>
<p>The reverse of these is achieved by capitalising the letter. So &quot;\D&quot; means &quot;anything not a digit&quot;, &quot;\P&quot; means &quot;anything not punctuation&quot;, &quot;\W&quot; means &quot;anything not a word character&quot;, &quot;\L&quot; means &quot;anything not a lower case letter&quot; and so on.</p>
<p><span class="boldface">7. Positional restrictions</span>. The notation &quot;^&quot; does not match anything, as such, but instead requires that we be positioned at the start of the text. Thus</p>
<!-- START CODE "c8136" -->
<a id="c8136"></a><blockquote class="code"><p class="quoted">
&quot;^fish&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches only &quot;fish&quot; at the start of the text, not occurring anywhere later on. Similarly, &quot;$&quot; requires that the position be the end of the text. So</p>
<!-- START CODE "c8137" -->
<a id="c8137"></a><blockquote class="code"><p class="quoted">
&quot;fish$&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches only if the last four characters are &quot;fish&quot;. Matching &quot;^fish$&quot; is the same thing as what Inform calls exactly matching &quot;fish&quot;.</p>
<p>Another useful notation is &quot;\b&quot;, which matches a word boundary: that is, it matches no actual text, but requires the position to be a junction between a word character and a non-word character (a &quot;\w&quot; and a &quot;\W&quot;) or vice versa. Thus</p>
<!-- START CODE "c8138" -->
<a id="c8138"></a><blockquote class="code"><p class="quoted">
&quot;\bfish\b&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches &quot;fish&quot; in &quot;some fish&quot; and also &quot;some fish, please!&quot;, but not in &quot;shellfish&quot;. (The regular expression &quot;\w*fish\b&quot; catches all words ending in &quot;fish&quot;, as we will see below.) As usual, the capitalised version &quot;\B&quot; negates this, and means &quot;not at a word boundary&quot;.</p>
<p><span class="boldface">8. Line break and tab</span>. The notations &quot;\n&quot; and &quot;\t&quot; are used for a line break (&quot;n&quot; for &quot;new line&quot;) and tab, respectively. Tabs normally do not occur in Inform strings, but can do when reading from files. It makes no sense to reverse these, so &quot;\N&quot; and &quot;\T&quot; produce errors.</p>
<p><span class="boldface">9. Repetition</span>. Placing a number in braces &quot;{&quot; and &quot;}&quot; after something says that it should be repeated that many times. Thus</p>
<!-- START CODE "c8139" -->
<a id="c8139"></a><blockquote class="code"><p class="quoted">
&quot;ax{25}&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches only on &quot;axxxxxxxxxxxxxxxxxxxxxxxxx&quot;. More usefully, perhaps, we can specify a range of the number of repetitions:</p>
<!-- START CODE "c8140" -->
<a id="c8140"></a><blockquote class="code"><p class="quoted">
&quot;ax{2,6}&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches only on &quot;axx&quot;, &quot;axxx&quot;, &quot;axxxx&quot;, &quot;axxxxx&quot;, &quot;axxxxxx&quot;. And we can leave the top end open: &quot;ax{2,}&quot; means &quot;a&quot; followed by at least two &quot;x&quot;s.</p>
<p>Note that the braces attach only to most recent thing - so &quot;ax{2}&quot; means &quot;a&quot; followed by two of &quot;x&quot; - but, as always, we can use grouping brackets to change that. So &quot;(ax){2,}&quot; matches &quot;axax&quot;, &quot;axaxax&quot;, &quot;axaxaxax&quot;,...</p>
<p>(It's probably best not to use Inform to try to match the human genome against &quot;&lt;acgt&gt;{3000000000}&quot;, but one of the most important practical uses of regular expression matching in science is in treating DNA as a string of nucleotides represented by the letters &quot;a&quot;, &quot;c&quot;, &quot;g&quot;, &quot;t&quot;, and looking for patterns.)</p>
<p><span class="boldface">10. Popular repetitions.</span> Three cases are so often needed that they have standard short forms:</p>
<p>&quot;{0,1}&quot;, which means 0 or 1 repetition of something - in other words, doesn't so much repeat it as make it optional - is written &quot;?&quot;. Thus &quot;ax?y&quot; matches only on &quot;ay&quot; or &quot;axy&quot;.</p>
<p>&quot;{0,}&quot;, which means 0 or more repetitions - in other words, any number at all - is written &quot;*&quot;. Thus &quot;ax*y&quot; matches on &quot;ay&quot;, &quot;axy&quot;, &quot;axxy&quot;, &quot;axxxy&quot;, ... and the omnivorous &quot;.*&quot; - which means &quot;anything, any number of times&quot; - matches absolutely every text. (Perhaps unexpectedly, replacing &quot;.*&quot; in a text with &quot;X&quot; will produce &quot;XX&quot;, not &quot;X&quot;, because the &quot;.*&quot; first matches the text, then matches the empty gap at the end. To match the entire text just once, try &quot;^.*$&quot;.)</p>
<p>&quot;{1,}&quot;, which means 1 or more repetitions, is written &quot;+&quot;. So &quot;\d+&quot; matches any run of digits, for instance.</p>
<p><span class="boldface">11. Greedy vs lazy.</span> Once we allow things to repeat an unknown number of times, we run into an ambiguity. Sure, &quot;\d+&quot; matches the text &quot;16339b&quot;. But does it look only as far as the &quot;1&quot;, then reason that it now has one or more digits in a row, and stop? Or does it run onward devouring digits until it can do so no longer, so matching the &quot;16339&quot; part? These two strategies are called &quot;lazy&quot; and &quot;greedy&quot; respectively.</p>
<p>Do we care? Well, the strategy used makes no difference to whether there is a match, but it does affect what part of the text is matched, and the number of matches there are. Unless we mark for it, all repetitions are greedy. Usually this is good, but it means that, for instance,</p>
<!-- START CODE "c8141" -->
<a id="c8141"></a><blockquote class="code"><p class="quoted">
&quot;-.+-&quot;
</p></blockquote>
<!-- END CODE -->
<p>applied to &quot;-alpha- -beta- -gamma-&quot; will match the whole text, because &quot;.+&quot; picks up all of &quot;alpha- -beta- -gamma&quot;. To get around this, we can mark any of the repetition operators as lazy by adding a question mark &quot;?&quot;. Thus:</p>
<!-- START CODE "c8142" -->
<a id="c8142"></a><blockquote class="code"><p class="quoted">
&quot;-.+?-&quot;
</p></blockquote>
<!-- END CODE -->
<p>applied to &quot;-alpha- -beta- -gamma-&quot; matches three times, producing &quot;-alpha-&quot; then &quot;-beta-&quot; then &quot;-gamma-&quot;.</p>
<p>A logical but sometimes confusing consequence is that a doubled question mark &quot;??&quot; means &quot;repeat 0 or 1 times, but prefer 0 matches to 1 if both are possibilities&quot;: whereas a single question mark &quot;?&quot;, being greedy, means &quot;repeat 0 or 1 times, but prefer 1 match to 0 if both are possibilities&quot;.</p>
<p><span class="boldface">12. Numbered groups.</span> We have already seen that round brackets are useful to clump together parts of the regular expression - to choose within them, or repeat them. In fact, Inform numbers these from 1 upwards as they are used from left to right, and we can subsequently refer back to their contents with the notation &quot;\1&quot;, &quot;\2&quot;, ... After a successful match, we can find the results of these subexpressions with:</p>
<!-- START PHRASE "defn312" -->
<div class="definition"><a id="defn312"></a><p class="defnprototype"><b>text matching subexpression </b>(number)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_subexpressiontext -->

<p>This phrase is only meaningful immediately after a successful match of a regular expression against text, and it produces the text which matched. The number must be from 1 to 9, and must correspond to one of the bracketed groups in the expression just matched. Example: after</p>
<!-- START CODE "c8143" -->
<a id="c8143"></a><blockquote class="code"><p class="quoted">
if &quot;taramasalata&quot; matches the regular expression &quot;a(r.*l)a(.)&quot;:
</p></blockquote>
<!-- END CODE -->
<p>the &quot;text matching regular expression&quot; is &quot;aramasalat&quot;, the &quot;text matching subexpression 1&quot; is &quot;ramasal&quot;, and &quot;text matching subexpression 2&quot; is &quot;t&quot;.</p>

<!-- end definition -->
</div>

<p>For instance:</p>
<!-- START CODE "c8144" -->
<a id="c8144"></a><blockquote class="code"><p class="quoted">
&quot;(\w)\w*\1&quot;
</p></blockquote>
<!-- END CODE -->
<p>matches any run of two or more word-characters, subject to the restriction that the last one has to be the same as the first - so it matches &quot;xerox&quot; but not &quot;alphabet&quot;. When Inform matches this against &quot;xerox&quot;, first it matches the initial &quot;x&quot; against the group &quot;(\w)&quot;. It then matches &quot;\w*&quot; (&quot;any number of word-characters&quot;) against &quot;ero&quot;, so that the &quot;*&quot; runs up to 3 repetitions. It then matches &quot;\1&quot; against the final &quot;x&quot;, because &quot;\1&quot; requires it to match against whatever last matched in sub-expression 1 - which was an &quot;x&quot;.</p>
<p>Numbered groups allow wicked tricks in matching, it's true, but really come into their own when it comes to replacing - as we shall see.</p>
<p><span class="boldface">13. Switching case sensitivity on and off.</span> The special notations &quot;(?i)&quot; and &quot;(?-i)&quot; switch sensitivity to upper vs. lower case off and on, mid-expression. Thus &quot;a(?i)bcd(?-i)e&quot; matches &quot;abcde&quot;, &quot;aBcDe&quot;, etc., but not &quot;Abcde&quot; or &quot;abcdE&quot;.</p>
<p><span class="boldface">14. Groups with special meanings.</span> This is the last of the special syntaxes: but it's a doozy. A round-bracketed group can be marked to behave in a special way by following the open bracket by a symbol with a special meaning. Groups like this have no number and are not counted as part of \1, \2, and so forth - they are intended not to gather up material but to have some effect of their own.</p>
<!-- START CODE "c8145" -->
<a id="c8145"></a><blockquote class="code"><p class="quoted">
&quot;(# ...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Is a comment, that is, causes the group to do nothing and match against anything.</p>
<!-- START CODE "c8146" -->
<a id="c8146"></a><blockquote class="code"><p class="quoted">
&quot;(?= ...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Is a lookahead: it is a form of positional requirement, like &quot;\b&quot; or &quot;^&quot;, but one which requires that the text ahead of us matches whatever is in the brackets. (It doesn't consume that text - only checks to see that it's there.) For instance &quot;\w+(?=;)&quot; matches a word followed by a semicolon, but does not match the semicolon itself.</p>
<!-- START CODE "c8147" -->
<a id="c8147"></a><blockquote class="code"><p class="quoted">
&quot;(?! ...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Is the same but negated: it requires that the text ahead of us does not match the material given. For instance, &quot;a+(?!z)&quot; matches any run of &quot;a&quot;s not followed by a &quot;z&quot;.</p>
<!-- START CODE "c8148" -->
<a id="c8148"></a><blockquote class="code"><p class="quoted">
&quot;(?&lt;= ...)&quot; and &quot;(?&lt;! ...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Are the same but looking behind (hence the &quot;&lt;&quot;), not forward. These are restricted to cases where Inform can determine that the material to be matched has a definite known width. For instance, &quot;(?&lt;!shell)fish&quot; matches any &quot;fish&quot; not occurring in &quot;shellfish&quot;.</p>
<!-- START CODE "c8149" -->
<a id="c8149"></a><blockquote class="code"><p class="quoted">
&quot;(&gt; ...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Is a possessive, that is, causes the material to be matched and, once matched, never lets go. No matter what subsequently turns out to be convenient, it will never change its match. For instance, &quot;\d+8&quot; matches against &quot;768&quot; because Inform realises that &quot;\d+&quot; cannot be allowed to eat the &quot;8&quot; if there is to be a match, and stops it. But &quot;(&gt;\d+)8&quot; does not match against &quot;768&quot; because now the &quot;\d+&quot;, which initially eats &quot;768&quot;, is possessive and refuses to give up the &quot;8&quot; once taken.</p>
<!-- START CODE "c8150" -->
<a id="c8150"></a><blockquote class="code"><p class="quoted">
&quot;(?(1)...)&quot; and &quot;(?(1)...|...)&quot;
</p></blockquote>
<!-- END CODE -->
<p>Are conditionals. These require us to match the material given if \1 has successfully matched already; in the second version, the material after the &quot;|&quot; must be matched if \1 has not successfully matched yet. And the same for 2, 3, ..., 9, of course.</p>
<p>Finally, conditionals can also use lookaheads or lookbehinds as their conditions. So for instance:</p>
<!-- START CODE "c8151" -->
<a id="c8151"></a><blockquote class="code"><p class="quoted">
&quot;(?(?=\d)\d\d\d\d|AY-\d\d\d\d)&quot;
</p></blockquote>
<!-- END CODE -->
<p>means if you start with a digit, match four digits; otherwise match &quot;AY-&quot; followed by four digits. There are easier ways to do this, of course, but the really juicy uses of conditionals are only borderline legible and make poor examples - perhaps this is telling us something.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s5" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s5" class="standardlink">Back to §20.5. Matching and exactly matching</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s7" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s7" class="standardlink">Onward to §20.7. Making new text with text substitutions</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e8" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e8" class="standardlink">Example 414: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Alpha</b>&#160;&#160;&#160; Creating a beta-testing command that matches any line starting with punctuation.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e319" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e319" class="standardlink">Example 415: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>About Inform's regular expression support</b>&#160;&#160;&#160; Some footnotes on Inform's regular expressions, and how they compare to those of other programming languages.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s7"></a>§20.7. Making new text with text substitutions</p>
<p>Substitutions are most often used just for printing, like so:</p>
<!-- START CODE "c8152" -->
<a id="c8152"></a><blockquote class="code"><p class="quoted">
say &quot;The clock reads [time of day].&quot;;
</p></blockquote>
<!-- END CODE -->
<p>But they can also produce text which can be stored up or used in other ways. For example, defining</p>
<!-- START CODE "c8153" -->
<a id="c8153"></a><blockquote class="code"><p class="quoted">
To decide what text is (T - text) doubled:
<br />&#160;&#160;&#160;&#160;decide on &quot;[T][T]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>makes</p>
<!-- START CODE "c8154" -->
<a id="c8154"></a><blockquote class="code"><p class="quoted">
let the Gerard Kenny reference be &quot;NewYork&quot; doubled;
</p></blockquote>
<!-- END CODE -->
<p>set this temporary variable to &quot;NewYorkNewYork&quot;.</p>
<p>There is, however, a subtlety here. A text with a substitution in it, like:</p>
<!-- START CODE "c8155" -->
<a id="c8155"></a><blockquote class="code"><p class="quoted">
&quot;The clock reads [time of day].&quot;
</p></blockquote>
<!-- END CODE -->
<p>is always waiting to be substituted, that is, to become something like:</p>
<!-- START CODE "c8156" -->
<a id="c8156"></a><blockquote class="code"><p class="quoted">
&quot;The clock reads 11:12 AM.&quot;
</p></blockquote>
<!-- END CODE -->
<p>If all we do with text is to print it, there's nothing to worry about. But if we're storing it up, especially for multiple turns, there are ambiguities. For example, suppose we're changing the look of the black status line bar at the top of the text window:</p>
<!-- START CODE "c8157" -->
<a id="c8157"></a><blockquote class="code"><p class="quoted">
now the left hand status line is &quot;[time of day]&quot;;
</p></blockquote>
<!-- END CODE -->
<p>Just copying &quot;[time of day]&quot; to the &quot;left hand status line&quot; variable doesn't make it substitute - which is just as well, or the top of the screen would perpetually show &quot;9:00 AM&quot;.</p>
<p>On the other hand, looking back at the phrase example:</p>
<!-- START CODE "c8158" -->
<a id="c8158"></a><blockquote class="code"><p class="quoted">
To decide what text is (T - text) doubled:
<br />&#160;&#160;&#160;&#160;decide on &quot;[T][T]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>&quot;[T][T]&quot; is substituted immediately it's formed. That's also a good thing, because &quot;T&quot; loses its meaning the moment the phrase finishes, which would make &quot;[T][T]&quot; meaningless anywhere else.</p>
<p>What's going on here is this: Inform substitutes text immediately if it contains references to a temporary value such as &quot;T&quot;, and otherwise only if it needs to access the contents. This is why &quot;[time of day]&quot; isn't substituted until we need to print it out (or, say, access the third character): &quot;time of day&quot; is a value which always exists, not a temporary one.</p>
<p>Using the adjectives &quot;substituted&quot; and &quot;unsubstituted&quot;, it's always possible to test whether a given text is in either state, should this ever be useful. For example,</p>
<!-- START CODE "c8159" -->
<a id="c8159"></a><blockquote class="code"><p class="quoted">
now the left hand status line is &quot;[time of day]&quot;;
<br />if the left hand status line is unsubstituted, say &quot;Yes!&quot;;
</p></blockquote>
<!-- END CODE -->
<p>will say &quot;Yes!&quot;: the LHSL is like a bomb waiting to go off. Speaking of which:</p>
<!-- START CODE "c8160" -->
<a id="c8160"></a><blockquote class="code"><p class="quoted">
The player is holding a temporal bomb.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8161" -->
<a id="c8161"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;now the left hand status line is &quot;Clock reads: [time of day]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8162" -->
<a id="c8162"></a><blockquote class="code"><p class="quoted">
After dropping the temporal bomb:
<br />&#160;&#160;&#160;&#160;now the left hand status line is the substituted form of the left hand status line;
<br />&#160;&#160;&#160;&#160;say &quot;Time itself is now broken. Well done.&quot;
</p></blockquote>
<!-- END CODE -->
<p>This is making use of:</p>
<!-- START PHRASE "defn313" -->
<div class="definition"><a id="defn313"></a><p class="defnprototype"><b>substituted form of </b>(text)<b> ... text</b></p>
<!-- END PHRASE -->
<!-- definition of ph_subform -->

<p>This takes a text and makes substitution occur immediately. For example,</p>
<!-- START CODE "c8163" -->
<a id="c8163"></a><blockquote class="code"><p class="quoted">
substituted form of &quot;time of death, [time of day]&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces something like &quot;time of death, 9:15 AM&quot; rather than &quot;time of death, [time of day]&quot;. It's entirely legal to apply this to text which never had any substitutions in, so</p>
<!-- START CODE "c8164" -->
<a id="c8164"></a><blockquote class="code"><p class="quoted">
substituted form of &quot;balloon&quot;
</p></blockquote>
<!-- END CODE -->
<p>produces &quot;balloon&quot;.</p>

<!-- end definition -->
</div>

<p>Note that there's no analogous phrase for &quot;unsubstituted form of...&quot;, because once text has substituted, there's no way to go back.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s6" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s6" class="standardlink">Back to §20.6. Regular expression matching</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s8" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s8" class="standardlink">Onward to §20.8. Replacements</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e197" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e197" class="standardlink">Example 416: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Identity Theft</b>&#160;&#160;&#160; Allowing the player to enter a name to be used for the player character during the game.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e250" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e250" class="standardlink">Example 417: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Mirror, Mirror</b>&#160;&#160;&#160; The sorcerer's mirror can, when held up high, form an impression of its surroundings which it then preserves.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e95" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e95" class="standardlink">Example 418: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>The Cow Exonerated</b>&#160;&#160;&#160; Creating a class of matches that burn for a time and then go out, with elegant reporting when several matches go out at once.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s8"></a>§20.8. Replacements</p>
<p>Suppose V is a text which varies - perhaps a property of something, or a variable defined everywhere, or a temporary &quot;let&quot;-named value. How do we change its contents? The easiest way is simply to assign text to it. Thus:</p>
<!-- START CODE "c8165" -->
<a id="c8165"></a><blockquote class="code"><p class="quoted">
let V be &quot;It is now [the time of the day in words].&quot;
</p></blockquote>
<!-- END CODE -->
<p>And, for instance,</p>
<!-- START CODE "c8166" -->
<a id="c8166"></a><blockquote class="code"><p class="quoted">
let V be &quot;[V]!&quot;
</p></blockquote>
<!-- END CODE -->
<p>adds an exclamation mark at the end of V.</p>
<p>Otherwise, it is more useful (also a little faster) to modify V by changing its characters, words and so on. Thus:</p>
<!-- START PHRASE "defn314" -->
<div class="definition"><a id="defn314"></a><p class="defnprototype"><b>replace character number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacechar -->

<p>This phrase acts on the named text by placing the given text in place of the Nth character, counting from 1. Example:</p>
<!-- START CODE "c8167" -->
<a id="c8167"></a><blockquote class="code"><p class="quoted">
let V be &quot;mope&quot;;
<br />replace character number 3 in V with &quot;lecul&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;molecule&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn315" -->
<div class="definition"><a id="defn315"></a><p class="defnprototype"><b>replace word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing or punctuation. Example:</p>
<!-- START CODE "c8168" -->
<a id="c8168"></a><blockquote class="code"><p class="quoted">
let V be &quot;Does the well run dry?&quot;;
<br />replace word number 3 in V with &quot;jogger&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Does the jogger run dry?&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn316" -->
<div class="definition"><a id="defn316"></a><p class="defnprototype"><b>replace punctuated word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing, counting punctuation runs as words in their own right. Example:</p>
<!-- START CODE "c8169" -->
<a id="c8169"></a><blockquote class="code"><p class="quoted">
let V be &quot;Frankly, yes, I agree.&quot;;
<br />replace punctuated word number 2 in V with &quot;:&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Frankly: yes, I agree.&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn317" -->
<div class="definition"><a id="defn317"></a><p class="defnprototype"><b>replace unpunctuated word number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceupword -->

<p>This phrase acts on the named text by placing the given text in place of the Nth word, counting from 1, and dividing words at spacing, counting punctuation as part of a word just as if it were lettering. Example:</p>
<!-- START CODE "c8170" -->
<a id="c8170"></a><blockquote class="code"><p class="quoted">
let V be &quot;Frankly, yes, I agree.&quot;;
<br />replace unpunctuated word number 2 in V with &quot;of course&quot;;
<br />say V;
</p></blockquote>
<!-- END CODE -->
<p>says &quot;Frankly, of course I agree.&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn318" -->
<div class="definition"><a id="defn318"></a><p class="defnprototype"><b>replace line number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replaceline -->

<p>This phrase acts on the named text by placing the given text in place of the Nth line, counting from 1. Lines are divided by paragraph or line breaks.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn319" -->
<div class="definition"><a id="defn319"></a><p class="defnprototype"><b>replace paragraph number </b>(number)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepara -->

<p>This phrase acts on the named text by placing the given text in place of the Nth paragraph, counting from 1.</p>

<!-- end definition -->
</div>

<p>Last, but not least, we can replace text wherever it occurs:</p>
<!-- START PHRASE "defn320" -->
<div class="definition"><a id="defn320"></a><p class="defnprototype"><b>replace the text </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replace -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible. Example:</p>
<!-- START CODE "c8171" -->
<a id="c8171"></a><blockquote class="code"><p class="quoted">
replace the text &quot;a&quot; in V with &quot;z&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes every lower-case &quot;a&quot; to &quot;z&quot;: the same thing done with the &quot;case insensitively&quot; option would change each &quot;a&quot; or &quot;A&quot; to &quot;z&quot;.</p>

<!-- end definition -->
</div>

<p>All very well for letters, but it can be unfortunate to try</p>
<!-- START CODE "c8172" -->
<a id="c8172"></a><blockquote class="code"><p class="quoted">
replace the text &quot;Bob&quot; in V with &quot;Robert&quot;
</p></blockquote>
<!-- END CODE -->
<p>if V happens to contain, say &quot;The Olympic Bobsleigh Team&quot;: it would become &quot;The Olympic Robertsleigh Team&quot;. What we want, of course, is for Bob to become Robert only when it's a whole word. We can get that with:</p>
<!-- START PHRASE "defn321" -->
<div class="definition"><a id="defn321"></a><p class="defnprototype"><b>replace the word </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacewordin -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible, where the search text must occur as a whole word. Example:</p>
<!-- START CODE "c8173" -->
<a id="c8173"></a><blockquote class="code"><p class="quoted">
replace the word &quot;Bob&quot; in V with &quot;Robert&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes &quot;Bob got on the Bobsleigh&quot; to &quot;Robert got on the Bobsleigh&quot;.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn322" -->
<div class="definition"><a id="defn322"></a><p class="defnprototype"><b>replace the punctuated word </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacepwordin -->

<p>This phrase acts on the named text by searching and replacing, as many non-overlapping times as possible, where the search text must occur as a whole word or run of punctuation.</p>

<!-- end definition -->
</div>

<p>But these are all just special cases of the grand-daddy of all replacement phrases:</p>
<!-- START PHRASE "defn323" -->
<div class="definition"><a id="defn323"></a><p class="defnprototype"><b>replace the regular expression </b>(text)<b> in </b>(text)<b> with </b>(text)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_replacere -->

<p>This phrase acts on the named text by matching the regular expression and replacing anything which fits it, as many non-overlapping times as possible. Example:</p>
<!-- START CODE "c8174" -->
<a id="c8174"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\d+&quot; in V with &quot;...&quot;
</p></blockquote>
<!-- END CODE -->
<p>changes &quot;The Battle of Waterloo, 1815, rivalled Trafalgar, 1805&quot; to &quot;The Battle of Waterloo, ..., rivalled Trafalgar, ...&quot;. The &quot;case insensitively&quot; causes lower and upper case letters to be treated as if the same letter.</p>
<p>When replacing a regular expression, the replacement text also has a few special meanings (though, thankfully, many fewer than for the expression itself). Once again &quot;\n&quot; and &quot;\t&quot; can be used for line break and tab characters, and &quot;\\&quot; must be used for an actual backslash. But, very usefully, &quot;\1&quot; to &quot;\9&quot; expand as the contents of groups numbered 1 to 9, and &quot;\0&quot; to the exact text matched. So:</p>
<!-- START CODE "c8175" -->
<a id="c8175"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\d+&quot; in V with &quot;roughly \0&quot;
</p></blockquote>
<!-- END CODE -->
<p>adds the word &quot;roughly&quot; in front of any run of digits in V, because \0 becomes in turn whichever run of digits matched. And</p>
<!-- START CODE "c8176" -->
<a id="c8176"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;(\w+) (.*)&quot; in V with &quot;\2, \1&quot;
</p></blockquote>
<!-- END CODE -->
<p>performs the transformation &quot;Frank Booth&quot; to &quot;Booth, Frank&quot;.</p>
<p>Finally, prefixing the number by &quot;l&quot; or &quot;u&quot; forces the text it represents into lower or upper case, respectively. For instance:</p>
<!-- START CODE "c8177" -->
<a id="c8177"></a><blockquote class="code"><p class="quoted">
replace the regular expression &quot;\b(\w)(\w*)&quot; in X with &quot;\u1\l2&quot;;
</p></blockquote>
<!-- END CODE -->
<p>changes the casing of X to &quot;title casing&quot;, where each individual word is capitalised. (This is a little slow on large texts, since so many matches and replacements are made: it's more efficient to use the official phrases for changing case.)</p>

<!-- end definition -->
</div>

<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s7" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s7" class="standardlink">Back to §20.7. Making new text with text substitutions</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s9" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_20.html#s9" class="standardlink">Onward to §20.9. Summary of regular expression notation</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e37" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e37" class="standardlink">Example 419: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Blackout</b>&#160;&#160;&#160; Filtering the names of rooms printed while in darkness.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e141" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e141" class="standardlink">Example 420: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Fido</b>&#160;&#160;&#160; A dog the player can name and un-name at will.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e198" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e198" class="standardlink">Example 421: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Igpay Atinlay</b>&#160;&#160;&#160; A pig Latin filter for the player's commands.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e253" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e253" class="standardlink">Example 422: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Mr. Burns' Repast</b>&#160;&#160;&#160; Letting the player guess types for an unidentifiable fish.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e267" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e267" class="standardlink">Example 423: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Northstar</b>&#160;&#160;&#160; Making Inform understand ASK JOSH TO TAKE INVENTORY as JOSH, TAKE INVENTORY. This requires us to use a regular expression on the player's command, replacing some of the content.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#e69" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_20.html#e69" class="standardlink">Example 424: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Cave-troll</b>&#160;&#160;&#160; Determining that the command the player typed is invalid, editing it, and re-examining it to see whether it now reads correctly.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s9"></a>§20.9. Summary of regular expression notation</p>
<p><span class="boldface">MATCHING</span></p>
<p>Positional restrictions</p>
<!-- START CODE "c8178" -->
<a id="c8178"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">^</p></td><td class="quotedtablecell"><p class="quoted">Matches (accepting no text) only at the start of the text</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">$</p></td><td class="quotedtablecell"><p class="quoted">Matches (accepting no text) only at the end of the text</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\b</p></td><td class="quotedtablecell"><p class="quoted">Word boundary: matches at either end of text or between a \w and a \W</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\B</p></td><td class="quotedtablecell"><p class="quoted">Matches anywhere where \b does not match</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Backslashed character classes</p>
<!-- START CODE "c8179" -->
<a id="c8179"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">\char</p></td><td class="quotedtablecell"><p class="quoted">If char is other than a-z, A-Z, 0-9 or space, matches that literal char</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\\</p></td><td class="quotedtablecell"><p class="quoted">For example, this matches literal backslash &quot;\&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\n</p></td><td class="quotedtablecell"><p class="quoted">Matches literal line break character</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\t</p></td><td class="quotedtablecell"><p class="quoted">Matches literal tab character (but use this only with external files)</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8180" -->
<a id="c8180"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">\d</p></td><td class="quotedtablecell"><p class="quoted">Matches any single digit</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\l</p></td><td class="quotedtablecell"><p class="quoted">Matches any lower case letter (by Unicode 4.0.0 definition)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\p</p></td><td class="quotedtablecell"><p class="quoted">Matches any single punctuation mark: . , ! ? - / &quot; : ; ( ) [ ] { }</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\s</p></td><td class="quotedtablecell"><p class="quoted">Matches any single spacing character (space, line break, tab)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\u</p></td><td class="quotedtablecell"><p class="quoted">Matches any upper case letter (by Unicode 4.0.0 definition)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\w</p></td><td class="quotedtablecell"><p class="quoted">Matches any single word character (neither \p nor \s)</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8181" -->
<a id="c8181"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">\D</p></td><td class="quotedtablecell"><p class="quoted">Matches any single non-digit</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\L</p></td><td class="quotedtablecell"><p class="quoted">Matches any non-lower-case-letter</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\P</p></td><td class="quotedtablecell"><p class="quoted">Matches any single non-punctuation-mark</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\S</p></td><td class="quotedtablecell"><p class="quoted">Matches any single non-spacing-character</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\U</p></td><td class="quotedtablecell"><p class="quoted">Matches any non-upper-case-letter</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\W</p></td><td class="quotedtablecell"><p class="quoted">Matches any single non-word-character (i.e., matches either \p or \s)</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Other character classes</p>
<!-- START CODE "c8182" -->
<a id="c8182"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">.</p></td><td class="quotedtablecell"><p class="quoted">Matches any single character</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">&lt;...&gt;</p></td><td class="quotedtablecell"><p class="quoted">Character range: matches any single character inside</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">&lt;^...&gt;</p></td><td class="quotedtablecell"><p class="quoted">Negated character range: matches any single character not inside</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Inside a character range</p>
<!-- START CODE "c8183" -->
<a id="c8183"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">e-h</p></td><td class="quotedtablecell"><p class="quoted">Any character in the run &quot;e&quot; to &quot;h&quot; inclusive (and so on for other runs)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">&gt;...</p></td><td class="quotedtablecell"><p class="quoted">Starting with &quot;&gt;&quot; means that a literal close angle bracket is included</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\</p></td><td class="quotedtablecell"><p class="quoted">Backslash has the same meaning as for backslashed character classes: see above</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Structural</p>
<!-- START CODE "c8184" -->
<a id="c8184"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">|</p></td><td class="quotedtablecell"><p class="quoted">Divides alternatives: &quot;fish|fowl&quot; matches either</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?i)</p></td><td class="quotedtablecell"><p class="quoted">Always matches: switches to case-insensitive matching from here on</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?-i)</p></td><td class="quotedtablecell"><p class="quoted">Always matches: switches to case-sensitive matching from here on</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Repetitions</p>
<!-- START CODE "c8185" -->
<a id="c8185"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">...?</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; either 0 or 1 times, i.e., makes &quot;...&quot; optional</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">...*</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; 0 or more times: e.g. &quot;\s*&quot; matches an optional run of space</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">...+</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; 1 or more times: e.g. &quot;x+&quot; matches any run of &quot;x&quot;s</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">...{6}</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; exactly 6 times (similarly for other numbers, of course)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">...{2,5}</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; between 2 and 5 times</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">...{3,}</p></td><td class="quotedtablecell"><p class="quoted">Matches &quot;...&quot; 3 or more times</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">....?</p></td><td class="quotedtablecell"><p class="quoted">&quot;?&quot; after any repetition makes it &quot;lazy&quot;, matching as few repeats as it can</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Numbered subexpressions</p>
<!-- START CODE "c8186" -->
<a id="c8186"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">(...)</p></td><td class="quotedtablecell"><p class="quoted">Groups part of the expression together: matches if the interior matches</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\1</p></td><td class="quotedtablecell"><p class="quoted">Matches the contents of the 1st subexpression reading left to right</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\2</p></td><td class="quotedtablecell"><p class="quoted">Matches the contents of the 2nd, and so on up to &quot;\9&quot; (but no further)</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>Unnumbered subexpressions</p>
<!-- START CODE "c8187" -->
<a id="c8187"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">(# ...)</p></td><td class="quotedtablecell"><p class="quoted">Comment: always matches, and the contents are ignored</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?= ...)</p></td><td class="quotedtablecell"><p class="quoted">Lookahead: matches if the text ahead matches &quot;...&quot;, but doesn't consume it</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?! ...)</p></td><td class="quotedtablecell"><p class="quoted">Negated lookahead: matches if lookahead fails</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?&lt;= ...)</p></td><td class="quotedtablecell"><p class="quoted">Lookbehind: matches if the text behind matches &quot;...&quot;, but doesn't consume it</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?&lt;! ...)</p></td><td class="quotedtablecell"><p class="quoted">Negated lookbehind: matches if lookbehind fails</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(&gt; ...)</p></td><td class="quotedtablecell"><p class="quoted">Possessive: tries to match &quot;...&quot; and if it succeeds, never backtracks on this</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?(1)...)</p></td><td class="quotedtablecell"><p class="quoted">Conditional: if \1 has matched by now, require that &quot;...&quot; be matched</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?(1)...|...)</p></td><td class="quotedtablecell"><p class="quoted">Conditional: ditto, but if \1 has not matched, require the second part</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?(?=...)...|...)</p></td><td class="quotedtablecell"><p class="quoted">Conditional with lookahead as its condition for which to match</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">(?(?&lt;=...)...|...)</p></td><td class="quotedtablecell"><p class="quoted">Conditional with lookbehind as its condition for which to match</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p><span class="boldface">IN REPLACEMENT TEXT</span></p>
<!-- START CODE "c8188" -->
<a id="c8188"></a><blockquote class="code"><p class="quoted">
</p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">\char</p></td><td class="quotedtablecell"><p class="quoted">If char is other than a-z, A-Z, 0-9 or space, expands to that literal char</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\\</p></td><td class="quotedtablecell"><p class="quoted">In particular, &quot;\\&quot; expands to a literal backslash &quot;\&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\n</p></td><td class="quotedtablecell"><p class="quoted">Expands to a line break character</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\t</p></td><td class="quotedtablecell"><p class="quoted">Expands to a tab character (but use this only with external files)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\0</p></td><td class="quotedtablecell"><p class="quoted">Expands to the full text matched</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\1</p></td><td class="quotedtablecell"><p class="quoted">Expands to whatever the 1st bracketed subexpression matched</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\2</p></td><td class="quotedtablecell"><p class="quoted">Expands to whatever the 2nd matched, and so on up to &quot;\9&quot; (but no further)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\l0</p></td><td class="quotedtablecell"><p class="quoted">Expands to \0 converted to lower case (and so on for &quot;\l1&quot; to &quot;\l9&quot;)</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">\u0</p></td><td class="quotedtablecell"><p class="quoted">Expands to \0 converted to upper case (and so on for &quot;\u1&quot; to &quot;\u9&quot;)</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of Chapter 20: Advanced Text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_20.html#s8" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_20.html#s8" class="standardlink">Back to §20.8. Replacements</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_21.html#s1" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_21.html#s1" class="standardlink">Onward to Chapter 21: Lists: §21.1. Lists and entries</a></td></tr>
</table><hr />
</div>
<div class="bookexamples">
<p class="chapterheading">Examples from Chapter 20: Advanced Text</p><table class="centredtable"><tr><td class="roadsigndirection"><a href="WI_20.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_20.html" class="standardlink">Start of this chapter</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_21.html" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_21.html" class="standardlink">Chapter 21: Lists</a></td></tr>
<tr><td class="roadsigndirection"><a href="examples_alphabetical.html" class="standardlink"><img alt="arrow-down-right.png" src="images/arrow-down-right.png" /></a></td><td><a href="examples_alphabetical.html" class="standardlink">Indexes of the examples</a></td></tr>
</table><!-- START EXAMPLE "412: Capital City" "e63" -->
<a id="e63"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e63" class="eglink"><b>412</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e63" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Capital City</span></b></a><br />To arrange that the location information normally given on the left-hand side of the status line appears in block capitals.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_12.html#e63"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example63">
<p>Not much is needed for this. The only noteworthy point is that it doesn't work by changing the LHSL to &quot;[the player's surroundings in upper case]&quot;: it cannot do this because &quot;the player's surroundings&quot; is not a value. Instead, &quot;[the player's surroundings]&quot; is a text substitution sometimes printing the name of a room, sometimes printing &quot;Darkness&quot;, and so on. We must therefore load it into a text first, and then apply &quot;...in upper case&quot;.</p>
<!-- START CODE "c8189_63" -->
<a id="c8189_63"></a><blockquote class="code"><p class="quoted">
&quot;Capital City&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8190_63" -->
<a id="c8190_63"></a><blockquote class="code"><p class="quoted">
Capital City is a room. East is Lower Caissons. South of Lower Caissons
<br />is San Seriffe. East of San Seriffe is a dark room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8191_63" -->
<a id="c8191_63"></a><blockquote class="code"><p class="quoted">
To say the player's capitalised surroundings:
<br />&#160;&#160;&#160;&#160;let the masthead be &quot;[the player's surroundings]&quot; in upper case;
<br />&#160;&#160;&#160;&#160;say the masthead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8192_63" -->
<a id="c8192_63"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;now the left hand status line is &quot;[the player's capitalised surroundings]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8193_63" -->
<a id="c8193_63"></a><blockquote class="code"><p class="quoted">
Test me with &quot;e / s / e&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "413: Rocket Man" "e328" -->
<a id="e328"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e328" class="eglink"><b>413</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e328" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Rocket Man</span></b></a><br />Using case changes on any text produced by a "to say..." phrase.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_2.html#e328"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example328">
<p>We can now change the case of any text produced by a &quot;to say...&quot; phrase. This is often useful when we would like to make use of a standard say phrase in some new context. Say, for instance, that we would like to &quot;[is-are the list...]&quot; in a context that needs the first letter to be capitalized.</p>
<p>We could write a new say phrase, such as &quot;to say is-are the list of (N - a description of objects) in sentence capitalization&quot;; but there is an easier way, and that is to set a text variable to the output of the to say phrase, and then print that text in the case of our choice.</p>
<p>For example:</p>
<!-- START CODE "c8194_328" -->
<a id="c8194_328"></a><blockquote class="code"><p class="quoted">
&quot;Rocket Man&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8195_328" -->
<a id="c8195_328"></a><blockquote class="code"><p class="quoted">
Instead of going somewhere from the spaceport when the player carries something:
<br />&#160;&#160;&#160;&#160;let N be &quot;[is-are the list of things carried by the player] really suitable gear to take to the moon?&quot; in sentence case;
<br />&#160;&#160;&#160;&#160;say &quot;[N][paragraph break]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8196_328" -->
<a id="c8196_328"></a><blockquote class="code"><p class="quoted">
The Spaceport is a room. North of the Spaceport is the Rocket Launch Pad. The player carries a stuffed bear, a chocolate cookie, and a book.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8197_328" -->
<a id="c8197_328"></a><blockquote class="code"><p class="quoted">
The description of the book is &quot;It is entitled [italic type]Why Not To Take [sentence cased inventory] To The Moon[roman type].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8198_328" -->
<a id="c8198_328"></a><blockquote class="code"><p class="quoted">
To say sentence cased inventory:
<br />&#160;&#160;&#160;&#160;let N be &quot;[a list of things carried by the player]&quot; in title case;
<br />&#160;&#160;&#160;&#160;say &quot;[N]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8199_328" -->
<a id="c8199_328"></a><blockquote class="code"><p class="quoted">
Test me with &quot;n / x book&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "414: Alpha" "e8" -->
<a id="e8"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e8" class="eglink"><b>414</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e8" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Alpha</span></b></a><br />Creating a beta-testing command that matches any line starting with punctuation.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_13.html#e8"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example8">
<p>Sometimes we want to let testers of a game insert their own comments during a transcript, without those comments wasting turns of the game or producing lengthy or inappropriate parser errors. Many testers have a habit of prefacing comments with a punctuation mark, so let's say that we'd like to catch any command that starts with any punctuation at all:</p>
<!-- START CODE "c8200_8" -->
<a id="c8200_8"></a><blockquote class="code"><p class="quoted">
 &quot;Alpha&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8201_8" -->
<a id="c8201_8"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;say &quot;Hi, Larry! Thanks for testing my game!!&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8202_8" -->
<a id="c8202_8"></a><blockquote class="code"><p class="quoted">
Unimplemented Room is a room. &quot;Room description goes here...&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8203_8" -->
<a id="c8203_8"></a><blockquote class="code"><p class="quoted">
The scary troll is a man in Unimplemented Room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8204_8" -->
<a id="c8204_8"></a><blockquote class="code"><p class="quoted">
After reading a command (this is the ignore beta-comments rule):
<br />&#160;&#160;&#160;&#160;if the player's command matches the regular expression &quot;^\p&quot;:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;(Noted.)&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8205_8" -->
<a id="c8205_8"></a><blockquote class="code"><p class="quoted">
Test me with &quot;x me / x troll / !this game is a bit dull so far / kiss troll / ? does this troll do anything? / :yawn&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "415: About Inform's regular expression support" "e319" -->
<a id="e319"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e319" class="eglink"><b>415</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e319" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">About Inform's regular expression support</span></b></a><br />Some footnotes on Inform's regular expressions, and how they compare to those of other programming languages.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_1.html#e319"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example319">
<p>There is not really any unanimity about what regular expression language is. The unix tools sed and grep extend on Kleene's original grammar. Henry Spencer's regex library extended on this again, and was a foundation for Perl, but Perl once again went further. Philip Hazel's PCRE, despite the name Perl Compatible Regular Expressions, makes further extensions still, and so on.</p>
<p>Inform's regular expressions are modelled on those of Perl, as the best de facto standard we have, but a few omissions have been inevitable. Inform's regex matcher must occupy source code less than one hundredth the size of PCRE, and it has very little memory. Inform aims to behave exactly like Perl except as follows:</p>
<!-- START CODE "c8206_319" -->
<a id="c8206_319"></a><blockquote class="code"><p class="quoted">
(i) Inform allows angle brackets as synonymous with square brackets, for reasons explained above. This means literal angle brackets have to be escaped as &quot;\&lt;&quot; and &quot;\&gt;&quot; in Inform regular expressions, which is unnecessary in Perl.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8207_319" -->
<a id="c8207_319"></a><blockquote class="code"><p class="quoted">
(ii) Inform only has single-line mode, not multiline mode: this removes need for the mode-switches &quot;(?m)&quot; and &quot;(?s)&quot; and the positional markers &quot;\A&quot; and &quot;\Z&quot;. Multiline mode is idiosyncratic to Perl and is a messy compromise to do with holding long files of text as single strings, yet treating them as lists of lines at the same time: this would not be sensible for Inform. Similarly, because there is no ambiguity about how line breaks are represented in Inform strings (by a single &quot;\n&quot;), initial newline convention markers such as &quot;(*ANYCRLF)&quot; are unsupported.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8208_319" -->
<a id="c8208_319"></a><blockquote class="code"><p class="quoted">
(iii) The codes &quot;\a&quot;, &quot;\r&quot;, &quot;\f&quot;, &quot;\e&quot;, &quot;\0&quot; for alarm, carriage return, form feed, escape and the zero character are unsupported: none of these can occur in an Inform string.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8209_319" -->
<a id="c8209_319"></a><blockquote class="code"><p class="quoted">
(iv) Inform does not allow characters to be referred to by character code (whereas Perl allows &quot;\036&quot; for an octal character code, &quot;\x7e&quot; for a hexadecimal one, &quot;\cD&quot; for a control character). This is because we do not want the user to know whether text is internally stored as ZSCII or Unicode.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8210_319" -->
<a id="c8210_319"></a><blockquote class="code"><p class="quoted">
(v) Inform's character class &quot;\p&quot; (and its negation &quot;\P&quot;) have no equivalent in Perl, and Inform's understanding of &quot;\w&quot; is different. Perl defines this as an upper or lower case English letter, underscore or digit, which is good for programming-language identifiers, but bad for natural language - for instance, &quot;é&quot; is not matched by &quot;\w&quot; in Perl, but unquestionably it appears in words. Inform therefore defines &quot;\w&quot; as the negation of &quot;\s&quot; union &quot;\p&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8211_319" -->
<a id="c8211_319"></a><blockquote class="code"><p class="quoted">
(vi) Inform supports only single-digit grouping numbers &quot;\1&quot; to &quot;\9&quot;, whereas Perl allows &quot;\10&quot;, &quot;\11&quot;, ...
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8212_319" -->
<a id="c8212_319"></a><blockquote class="code"><p class="quoted">
(vii) POSIX named character ranges are not supported. These are only abbreviations in any case, and are not very useful. (Note that the POSIX range &quot;[:punct:]&quot;, which is supposedly for punctuation, includes many things we do not want to think of that way - percentage signs, for instance - and so &quot;\p&quot; has a more natural-language-based definition.)
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8213_319" -->
<a id="c8213_319"></a><blockquote class="code"><p class="quoted">
(viii) Character classes can be used inside ranges, so that &quot;&lt;\da-f&gt;&quot; is legal, but not as ends of contiguous runs, so that &quot;&lt;\d-X&gt;&quot; is not legal. (As reckless as this is, it is legal in Perl.)
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8214_319" -->
<a id="c8214_319"></a><blockquote class="code"><p class="quoted">
(ix) For obvious reasons, escapes to Perl code using the notation &quot;(?{...})&quot; are unsupported, and so is the Perl iteration operator &quot;\G&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8215_319" -->
<a id="c8215_319"></a><blockquote class="code"><p class="quoted">
(x) Perl's extended mode &quot;(?x)&quot;, a lexical arrangement which allows expressions to be expanded out as little computer programs with comments, is unsupported. It would look awful syntax-coloured in the Inform interface and is not a style of coding to be encouraged.
</p></blockquote>
<!-- END CODE -->
<p>Inform further does not support the Python extension of named subexpression groups, nor the Java extension of the possessive quantifier &quot;++&quot;. There was only so much functionality we could squeeze in.</p>
<p>As verification of Inform's matching algorithm, we took the Perl 5 source code's notorious &quot;re-test.txt&quot; set of 961 test cases, removed the 316 using features unsupported by Inform (220 tested multiline mode, for instance), and ran the remaining 645 cases through Inform. It agrees with Perl on 643 of these: the two outstanding are -</p>
<!-- START CODE "c8216_319" -->
<a id="c8216_319"></a><blockquote class="code"><p class="quoted">
(i) Perl is able to match &quot;^(a\1?){4}$&quot; against &quot;aaaaaa&quot; but Inform is not - Inform's backtracking is not as good when it comes to repetitions of groupings which are recursively defined. (Note that the optional &quot;\1&quot; match refers to the value of the bracketed expression which contains it, so that the interpretation is different on each repetition. Here to match we have to interpret &quot;?&quot; as 0, 0, 1, 0 repeats respectively as we work through the &quot;{4}&quot;.)
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8217_319" -->
<a id="c8217_319"></a><blockquote class="code"><p class="quoted">
(ii) Perl matches &quot;((&lt;a-c&gt;)b*?\2)*&quot; against &quot;ababbbcbc&quot; finding the match &quot;ababb&quot;, whereas Inform finds the match &quot;ababbbcbc&quot;. This is really a difference of opinion about whether the outer asterisk, which is greedy, should be allowed three matches rather than two if to do so requires the inner asterisk, which is not greedy, to eat more than it needs on one of those three matches.
</p></blockquote>
<!-- END CODE -->
<p>Case (i) is a sacrifice to enable Inform's back-tracking to use less memory. Case (ii) simply seems unimportant.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "416: Identity Theft" "e197" -->
<a id="e197"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e197" class="eglink"><b>416</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e197" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Identity Theft</span></b></a><br />Allowing the player to enter a name to be used for the player character during the game.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_5.html#e197"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example197">
<p>Let's say we want to allow the player to enter any name he likes for his character. Moreover, we want to reject very long names (which are likely to be mistakes anyway), and we want to extract the player's chosen first name from the rest.</p>
<!-- START CODE "c8218_197" -->
<a id="c8218_197"></a><blockquote class="code"><p class="quoted">
 &quot;Identity Theft&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8219_197" -->
<a id="c8219_197"></a><blockquote class="code"><p class="quoted">
The player's forename is a text that varies. The player's full name is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8220_197" -->
<a id="c8220_197"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;What is your name? &gt; &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8221_197" -->
<a id="c8221_197"></a><blockquote class="code"><p class="quoted">
To decide whether collecting names:
<br />&#160;&#160;&#160;&#160;if the command prompt is &quot;What is your name? &gt; &quot;, yes;
<br />&#160;&#160;&#160;&#160;no.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8222_197" -->
<a id="c8222_197"></a><blockquote class="code"><p class="quoted">
After reading a command when collecting names:
<br />&#160;&#160;&#160;&#160;if the number of words in the player's command is greater than 5:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[paragraph break]Who are you, a member of the British royal family? No one has that many names. Let's try this again.&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command;
<br />&#160;&#160;&#160;&#160;now the player's full name is the player's command;
<br />&#160;&#160;&#160;&#160;now the player's forename is word number 1 in the player's command;
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;&gt;&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;Hi, [player's forename]![paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[banner text]&quot;;
<br />&#160;&#160;&#160;&#160;move the player to the location;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<p>We also want to postpone the proper beginning of the game until we've gotten the name:</p>
<!-- START CODE "c8223_197" -->
<a id="c8223_197"></a><blockquote class="code"><p class="quoted">
Instead of looking when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8224_197" -->
<a id="c8224_197"></a><blockquote class="code"><p class="quoted">
Rule for printing the banner text when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8225_197" -->
<a id="c8225_197"></a><blockquote class="code"><p class="quoted">
Rule for constructing the status line when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8226_197" -->
<a id="c8226_197"></a><blockquote class="code"><p class="quoted">
Your Bedroom is a room. The printed name of Your Bedroom is &quot;[player's forename]'s Bedroom&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8227_197" -->
<a id="c8227_197"></a><blockquote class="code"><p class="quoted">
The player carries a letter. The description of the letter is &quot;Dear [player's full name], [paragraph break]You have won the Norwegian Daily Lottery! ...&quot;.
</p></blockquote>
<!-- END CODE -->
<p>If we are compiling for Glulx, this is enough to capture not only the player's name but also the capitalization he uses.</p>
<p>If we are compiling for the Z-machine, the player's input will unfortunately be reduced to lower case before we can inspect it. If we would like by default to capitalize the first letter of each word of the name, we might substitute the following after reading a command rule:</p>
<!-- START CODE "c8228_197" -->
<a id="c8228_197"></a><blockquote class="code"><p class="quoted">
After reading a command when collecting names:
<br />&#160;&#160;&#160;&#160;if the number of words in the player's command is greater than 5:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[paragraph break]Who are you, a member of the British royal family? No one has that many names. Let's try this again.&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command;
<br />&#160;&#160;&#160;&#160;now the player's full name is the substituted form of &quot;[the player's command in title case]&quot;;
<br />&#160;&#160;&#160;&#160;now the player's forename is word number 1 in the player's full name;
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;&gt;&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;Hi, [player's forename]![paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[banner text]&quot;;
<br />&#160;&#160;&#160;&#160;move the player to the location;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "417: Mirror, Mirror" "e250" -->
<a id="e250"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e250" class="eglink"><b>417</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e250" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Mirror, Mirror</span></b></a><br />The sorcerer's mirror can, when held up high, form an impression of its surroundings which it then preserves.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_9.html#e250"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example250">
<!-- START CODE "c8229_250" -->
<a id="c8229_250"></a><blockquote class="code"><p class="quoted">
&quot;Mirror, Mirror&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8230_250" -->
<a id="c8230_250"></a><blockquote class="code"><p class="quoted">
The Sorcerer's Workshop is a room. &quot;The sorcerer's den is a dusty, whispering place. A grandfather clock with skeletal hands reads [the time of day in words]. The floorboards are stained where that porridge just wouldn't come out.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8231_250" -->
<a id="c8231_250"></a><blockquote class="code"><p class="quoted">
The Apprentice's Pantry is east of the Workshop. &quot;This is where the aproned apprentice traditionally makes the camomile tea, cleans out the jackdaw cages and furtively examines purloined artefacts.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8232_250" -->
<a id="c8232_250"></a><blockquote class="code"><p class="quoted">
When play begins: erase the mirror.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8233_250" -->
<a id="c8233_250"></a><blockquote class="code"><p class="quoted">
The player carries a magic mirror. The magic mirror has a text called the mirror vision.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8234_250" -->
<a id="c8234_250"></a><blockquote class="code"><p class="quoted">
To erase the mirror: now mirror vision of the mirror is &quot;The mirror is polished clean, and has no impression upon it.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8235_250" -->
<a id="c8235_250"></a><blockquote class="code"><p class="quoted">
To say current room description: try looking.
<br />To expose the mirror:
<br />&#160;&#160;&#160;&#160;say &quot;The mirror shines momentarily with a dazzling light.[paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;now mirror vision of the mirror is the substituted form of &quot;The hazy image in the mirror preserves a past sight:[line break][current room description]All is distorted and yet living, as though the past and present are coterminous in the mirror.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8236_250" -->
<a id="c8236_250"></a><blockquote class="code"><p class="quoted">
Understand &quot;hold up [something preferably held]&quot; or &quot;hold [something preferably held] up&quot; as holding aloft. Holding aloft is an action applying to one carried thing. Report holding aloft: say &quot;You hold [the noun] aloft.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8237_250" -->
<a id="c8237_250"></a><blockquote class="code"><p class="quoted">
Instead of rubbing the mirror: erase the mirror; try examining the mirror. Instead of holding aloft the mirror: expose the mirror.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8238_250" -->
<a id="c8238_250"></a><blockquote class="code"><p class="quoted">
The description of the mirror is &quot;[mirror vision of the mirror]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8239_250" -->
<a id="c8239_250"></a><blockquote class="code"><p class="quoted">
Test me with &quot;look / examine mirror / hold up mirror / z / look / x mirror / rub mirror / east / hold mirror up / west / x mirror&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "418: The Cow Exonerated" "e95" -->
<a id="e95"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e95" class="eglink"><b>418</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e95" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">The Cow Exonerated</span></b></a><br />Creating a class of matches that burn for a time and then go out, with elegant reporting when several matches go out at once.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_10.html#e95"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example95">
<p>Here we create a class of matches that can be used to burn other objects. Our objectives are as follow:</p>
<p>Burned objects other than matches should be removed from play instantly (just as edible objects are instantly eaten). We could give everything its own burning duration, but that complicates matters and allows for fire to spread from one object to another; for an example of how to do that, see the example &quot;In Fire or in Flood&quot;.</p>
<p>Matches should be described to show whether they are burning or extinguished, and when the parser chooses one of several identical matches, it should make very clear which match it has selected.</p>
<p>The game must sensibly select and, if necessary, automatically light new matches to carry out a &gt;BURN THING command.</p>
<p>The matches must burn for a set number of turns before going out, never to be used again.</p>
<p>And finally, the part for which the text will be useful: when several matches go out in the same turn, we want the game to print</p>
<!-- START CODE "c8240_95" -->
<a id="c8240_95"></a><blockquote class="code"><p class="quoted">
Four matches go out.
</p></blockquote>
<!-- END CODE -->
<p>rather than</p>
<!-- START CODE "c8241_95" -->
<a id="c8241_95"></a><blockquote class="code"><p class="quoted">
A match goes out.
<br />A match goes out.
<br />A match goes out.
<br />A match goes out.
</p></blockquote>
<!-- END CODE -->
<p>This last function appears down in Section 3, if we wish to skip ahead and look at it.</p>
<!-- START CODE "c8242_95" -->
<a id="c8242_95"></a><blockquote class="code"><p class="quoted">
 &quot;The Cow Exonerated&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8243_95" -->
<a id="c8243_95"></a><blockquote class="code"><p class="quoted">
Section 1 - Simple Burning
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8244_95" -->
<a id="c8244_95"></a><blockquote class="code"><p class="quoted">
Understand the commands &quot;light&quot; and &quot;burn&quot; as something new.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8245_95" -->
<a id="c8245_95"></a><blockquote class="code"><p class="quoted">
Understand &quot;burn [something] with [strikable-match]&quot; as burning it with. Understand &quot;burn [something] with [something preferably held]&quot; as burning it with. Burning it with is an action applying to one thing and one carried thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8246_95" -->
<a id="c8246_95"></a><blockquote class="code"><p class="quoted">
Understand the command &quot;light&quot; as &quot;burn&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8247_95" -->
<a id="c8247_95"></a><blockquote class="code"><p class="quoted">
A thing can be flammable or impervious. A thing is usually impervious.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8248_95" -->
<a id="c8248_95"></a><blockquote class="code"><p class="quoted">
Check burning something with something (this is the burn only with flaming matches rule):
<br />&#160;&#160;&#160;&#160;if the second noun is not a strikable-match, say &quot;You can only light things with matches.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the second noun is not flaming, say &quot;[The second noun] needs to be burning first.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8249_95" -->
<a id="c8249_95"></a><blockquote class="code"><p class="quoted">
Check burning something with something (this is the burn only flammable things rule):
<br />&#160;&#160;&#160;&#160;if the noun is impervious, say &quot;[The noun] cannot be burned.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8250_95" -->
<a id="c8250_95"></a><blockquote class="code"><p class="quoted">
Check burning something with something (this is the burn only things not held rule):
<br />&#160;&#160;&#160;&#160;say &quot;[one of]It occurs to you to set down [the noun] before burning, just for safety's sake. [or]Again, you decide to put down [the noun] prior to burning. [or]You try setting down [the noun] as usual. [stopping][run paragraph on]&quot;;
<br />&#160;&#160;&#160;&#160;silently try the player dropping the noun;
<br />&#160;&#160;&#160;&#160;if the player encloses the noun, stop the action.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8251_95" -->
<a id="c8251_95"></a><blockquote class="code"><p class="quoted">
Carry out burning something with something (this is the simplistic burning rule):
<br />&#160;&#160;&#160;&#160;now the noun is nowhere.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8252_95" -->
<a id="c8252_95"></a><blockquote class="code"><p class="quoted">
Report burning something with something:
<br />&#160;&#160;&#160;&#160;say &quot;You burn up [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8253_95" -->
<a id="c8253_95"></a><blockquote class="code"><p class="quoted">
Rule for implicitly taking the second noun while burning something with something which is not a strikable-match:
<br />&#160;&#160;&#160;&#160;say &quot;You can only light things with matches.&quot;;
<br />&#160;&#160;&#160;&#160;stop the action.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8254_95" -->
<a id="c8254_95"></a><blockquote class="code"><p class="quoted">
Section 2 - Matches
</p></blockquote>
<!-- END CODE -->
<p>The word &quot;matches&quot; is used by Inform to compare snippets of text (see &quot;Reading a command&quot; in the Activities chapter). This can sometimes cause awkwardness if we also have a kind called &quot;match&quot;, so for the occasion we will give our matches a more specialized name, never visible to the player:</p>
<!-- START CODE "c8255_95" -->
<a id="c8255_95"></a><blockquote class="code"><p class="quoted">
A strikable-match is a kind of thing. The plural of strikable-match is s-matches.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8256_95" -->
<a id="c8256_95"></a><blockquote class="code"><p class="quoted">
A strikable-match has a number called duration. The duration of a strikable-match is usually 3.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8257_95" -->
<a id="c8257_95"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of a strikable-match: say &quot;match&quot;.
<br />Rule for printing the plural name of a strikable-match: say &quot;matches&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8258_95" -->
<a id="c8258_95"></a><blockquote class="code"><p class="quoted">
Understand &quot;match&quot; as a strikable-match. Understand &quot;matches&quot; as a strikable-match.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8259_95" -->
<a id="c8259_95"></a><blockquote class="code"><p class="quoted">
Flame-state is a kind of value. The flame-states are burnt, flaming, and new. Understand &quot;burning&quot; or &quot;lit&quot; as flaming. Understand &quot;unused&quot; as new.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8260_95" -->
<a id="c8260_95"></a><blockquote class="code"><p class="quoted">
A strikable-match has a flame-state. A strikable-match is usually new. Understand the flame-state property as describing a strikable-match.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8261_95" -->
<a id="c8261_95"></a><blockquote class="code"><p class="quoted">
Before printing the name of a strikable-match while asking which do you mean:
<br />&#160;&#160;&#160;&#160;say &quot;[flame-state] &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8262_95" -->
<a id="c8262_95"></a><blockquote class="code"><p class="quoted">
Before printing the name of a strikable-match while taking inventory:
<br />&#160;&#160;&#160;&#160;say &quot;[flame-state] &quot;.
<br />Before printing the plural name of a strikable-match while taking inventory:
<br />&#160;&#160;&#160;&#160;say &quot;[flame-state] &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8263_95" -->
<a id="c8263_95"></a><blockquote class="code"><p class="quoted">
Before printing the name of a strikable-match while clarifying the parser's choice of something:
<br />&#160;&#160;&#160;&#160;if not taking inventory, say &quot;[flame-state] &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8264_95" -->
<a id="c8264_95"></a><blockquote class="code"><p class="quoted">
After printing the name of a strikable-match (called special-target) while clarifying the parser's choice of something:
<br />&#160;&#160;&#160;&#160;if the player carries the special-target:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot; you're carrying&quot;;
<br />&#160;&#160;&#160;&#160;otherwise if the special-target is in the location:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot; on the ground&quot;;
<br />&#160;&#160;&#160;&#160;otherwise:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot; [if the holder of the special-target is a container]in[otherwise]on[end if] [the holder of the special-target]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8265_95" -->
<a id="c8265_95"></a><blockquote class="code"><p class="quoted">
Understand &quot;strike [something]&quot; as attacking.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8266_95" -->
<a id="c8266_95"></a><blockquote class="code"><p class="quoted">
Understand &quot;strike [strikable-match]&quot; as striking. Striking is an action applying to one carried thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8267_95" -->
<a id="c8267_95"></a><blockquote class="code"><p class="quoted">
Understand &quot;burn [strikable-match]&quot; as striking.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8268_95" -->
<a id="c8268_95"></a><blockquote class="code"><p class="quoted">
Does the player mean striking a new strikable-match:
<br />&#160;&#160;&#160;&#160;it is very likely.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8269_95" -->
<a id="c8269_95"></a><blockquote class="code"><p class="quoted">
Does the player mean striking a burnt strikable-match:
<br />&#160;&#160;&#160;&#160;it is unlikely.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8270_95" -->
<a id="c8270_95"></a><blockquote class="code"><p class="quoted">
Check striking a strikable-match (this is the strike only new matches rule):
<br />&#160;&#160;&#160;&#160;if the noun is burnt, say &quot;[The noun] has already burnt down and cannot be relit.&quot; instead;
<br />&#160;&#160;&#160;&#160;if the noun is flaming, say &quot;[The noun] is already burning.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8271_95" -->
<a id="c8271_95"></a><blockquote class="code"><p class="quoted">
Carry out striking a strikable-match (this is the standard striking rule):
<br />&#160;&#160;&#160;&#160;now the noun is flaming;
<br />&#160;&#160;&#160;&#160;now the noun is lit.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8272_95" -->
<a id="c8272_95"></a><blockquote class="code"><p class="quoted">
Report striking a strikable-match (this is the standard report striking rule):
<br />&#160;&#160;&#160;&#160;say &quot;You light [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8273_95" -->
<a id="c8273_95"></a><blockquote class="code"><p class="quoted">
Before burning something with a new strikable-match (this is the prior lighting rule):
<br />&#160;&#160;&#160;&#160;say &quot;(first [if the player does not carry the second noun]taking and [end if]lighting [the second noun])[command clarification break]&quot;;
<br />&#160;&#160;&#160;&#160;silently try striking the second noun;
<br />&#160;&#160;&#160;&#160;if the second noun is not flaming, stop the action.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8274_95" -->
<a id="c8274_95"></a><blockquote class="code"><p class="quoted">
Rule for implicitly taking a strikable-match (called target) while striking:
<br />&#160;&#160;&#160;&#160;try silently taking the target.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8275_95" -->
<a id="c8275_95"></a><blockquote class="code"><p class="quoted">
Does the player mean burning something with a flaming strikable-match:
<br />&#160;&#160;&#160;&#160;it is very likely.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8276_95" -->
<a id="c8276_95"></a><blockquote class="code"><p class="quoted">
Does the player mean burning something with a new strikable-match:
<br />&#160;&#160;&#160;&#160;it is likely.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8277_95" -->
<a id="c8277_95"></a><blockquote class="code"><p class="quoted">
Does the player mean burning something with a burnt strikable-match:
<br />&#160;&#160;&#160;&#160;it is unlikely.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8278_95" -->
<a id="c8278_95"></a><blockquote class="code"><p class="quoted">
Instead of burning a burnt strikable-match with something:
<br />&#160;&#160;&#160;&#160;say &quot;[The noun] is completely consumed and cannot be relit.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8279_95" -->
<a id="c8279_95"></a><blockquote class="code"><p class="quoted">
Section 3 - Putting the Matches Out
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8280_95" -->
<a id="c8280_95"></a><blockquote class="code"><p class="quoted">
Every turn:
<br />&#160;&#160;&#160;&#160;let N be 0; [here we track how many matches are being put out during this turn, so that we don't have to mention each match individually if several go out during the same move]
<br />&#160;&#160;&#160;&#160;repeat with item running through flaming s-matches:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;decrement the duration of the item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the duration of the item is 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the item is burnt;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the item is unlit;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the item is visible, increment N;
<br />&#160;&#160;&#160;&#160;if N is 1:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[if the number of visible flaming s-matches is greater than 0]One of the matches [otherwise if the number of burnt visible s-matches is greater than 1]Your last burning match [otherwise]The match [end if]goes out.&quot;;
<br />&#160;&#160;&#160;&#160;otherwise if N is greater than 1:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let enumeration be &quot;[N in words]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if N is the number of visible s-matches:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if N is two, say &quot;Both&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;otherwise say &quot;All [enumeration]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;otherwise:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[enumeration in title case]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot; matches go out[if a visible strikable-match is flaming], leaving [number of visible flaming s-matches in words] still lit[end if].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8281_95" -->
<a id="c8281_95"></a><blockquote class="code"><p class="quoted">
Section 4 - Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8282_95" -->
<a id="c8282_95"></a><blockquote class="code"><p class="quoted">
Old Chicago is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8283_95" -->
<a id="c8283_95"></a><blockquote class="code"><p class="quoted">
The player carries a flammable thing called a log. Understand &quot;wooden&quot; and &quot;wood&quot; as the log.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8284_95" -->
<a id="c8284_95"></a><blockquote class="code"><p class="quoted">
The player carries two s-matches. The matchbox is an open openable container. It contains five s-matches. The player carries the matchbox.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8285_95" -->
<a id="c8285_95"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;now every strikable-match carried by the player is flaming;
<br />&#160;&#160;&#160;&#160;now every strikable-match carried by the player is lit.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8286_95" -->
<a id="c8286_95"></a><blockquote class="code"><p class="quoted">
Test me with &quot;i / burn match / i / i / burn log with match / burn matchbox with match / i&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "419: Blackout" "e37" -->
<a id="e37"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e37" class="eglink"><b>419</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e37" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Blackout</span></b></a><br />Filtering the names of rooms printed while in darkness.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_2.html#e37"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example37">
<p>In this example, we want the names of rooms to be asterisked out if the player wanders around without the benefit of a candle. We can do this by treating the room names as text, then replacing every letter:</p>
<!-- START CODE "c8287_37" -->
<a id="c8287_37"></a><blockquote class="code"><p class="quoted">
 &quot;Blackout&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8288_37" -->
<a id="c8288_37"></a><blockquote class="code"><p class="quoted">
Tiny Room is a dark room. Absurdly Long-Named Room is a dark room. It is west of Tiny Room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8289_37" -->
<a id="c8289_37"></a><blockquote class="code"><p class="quoted">
The Candle Factory is north of Tiny Room. It contains a beeswax candle. The beeswax candle is lit.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8290_37" -->
<a id="c8290_37"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of a dark room:
<br />&#160;&#160;&#160;&#160;let N be &quot;[location]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\w&quot; in N with &quot;*&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[N]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8291_37" -->
<a id="c8291_37"></a><blockquote class="code"><p class="quoted">
Test me with &quot;w / look / e / n / get candle / s / w&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Notice that the hyphen in the Absurdly Long-Named Room does not get replaced. We could replace even that, if we liked, with</p>
<!-- START CODE "c8292_37" -->
<a id="c8292_37"></a><blockquote class="code"><p class="quoted">
&#160;&#160;&#160;&#160;replace the regular expression &quot;\S&quot; in N with &quot;*&quot;;
</p></blockquote>
<!-- END CODE -->
<p>which would catch every character that is not a space.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "420: Fido" "e141" -->
<a id="e141"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e141" class="eglink"><b>420</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e141" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Fido</span></b></a><br />A dog the player can name and un-name at will.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_8.html#e141"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example141">
<p>Suppose we'd like to have a dog which the player is allowed to name himself. We'd like to deal correctly with both</p>
<!-- START CODE "c8293_141" -->
<a id="c8293_141"></a><blockquote class="code"><p class="quoted">
&gt;name the dog fido
</p></blockquote>
<!-- END CODE -->
<p>and</p>
<!-- START CODE "c8294_141" -->
<a id="c8294_141"></a><blockquote class="code"><p class="quoted">
&gt;name the dog &quot;fido&quot;
</p></blockquote>
<!-- END CODE -->
<p>so we'll also need to strip quotation marks out of the command. We can do this as follows:</p>
<!-- START CODE "c8295_141" -->
<a id="c8295_141"></a><blockquote class="code"><p class="quoted">
 &quot;Fido&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8296_141" -->
<a id="c8296_141"></a><blockquote class="code"><p class="quoted">
The Back Yard is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8297_141" -->
<a id="c8297_141"></a><blockquote class="code"><p class="quoted">
A dog is an animal in Back Yard. The dog has some text called the nickname. The nickname of the dog is &quot;nothing&quot;. Understand the nickname property as describing the dog.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8298_141" -->
<a id="c8298_141"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of the dog when the nickname of the dog is not &quot;nothing&quot;:
<br />&#160;&#160;&#160;&#160;say &quot;[nickname of the dog]&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8299_141" -->
<a id="c8299_141"></a><blockquote class="code"><p class="quoted">
Naming it with is an action applying to one thing and one topic. Understand &quot;name [something] [text]&quot; as naming it with. Check naming it with: say &quot;You can't name that.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8300_141" -->
<a id="c8300_141"></a><blockquote class="code"><p class="quoted">
Instead of naming the dog with &quot;nothing&quot;:
<br />&#160;&#160;&#160;&#160;now the nickname of the dog is &quot;nothing&quot;;
<br />&#160;&#160;&#160;&#160;now the dog is improper-named;
<br />&#160;&#160;&#160;&#160;say &quot;You revoke your choice of dog-name.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8301_141" -->
<a id="c8301_141"></a><blockquote class="code"><p class="quoted">
Instead of naming the dog with something:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the topic understood]&quot;;
<br />&#160;&#160;&#160;&#160;replace the text &quot;'&quot; in N with &quot;&quot;;
<br />&#160;&#160;&#160;&#160;now the nickname of the dog is &quot;[N]&quot;;
<br />&#160;&#160;&#160;&#160;now the dog is proper-named;
<br />&#160;&#160;&#160;&#160;say &quot;The dog is now known as [nickname of the dog].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8302_141" -->
<a id="c8302_141"></a><blockquote class="code"><p class="quoted">
Test me with &quot;name the dog Fido / name the dog Lawrence / look / x lawrence / name Lawrence nothing / look / x lawrence&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "421: Igpay Atinlay" "e198" -->
<a id="e198"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e198" class="eglink"><b>421</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e198" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Igpay Atinlay</span></b></a><br />A pig Latin filter for the player's commands.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_2.html#e198"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example198">
<p>For the sake of argument, suppose we want to parrot back all the player's commands in pig Latin:</p>
<!-- START CODE "c8303_198" -->
<a id="c8303_198"></a><blockquote class="code"><p class="quoted">
 &quot;Igpay Atinlay&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8304_198" -->
<a id="c8304_198"></a><blockquote class="code"><p class="quoted">
Armfay is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8305_198" -->
<a id="c8305_198"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(&lt;aeiou&gt;+)(\w*)&quot; in N with &quot;\1\2ay&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(&lt;bcdfghjklmnpqrstvwxz&gt;+)(\w*)&quot; in N with &quot;\2\1ay&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[N][paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8306_198" -->
<a id="c8306_198"></a><blockquote class="code"><p class="quoted">
Test me with &quot;nix on the stupid&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "422: Mr. Burns' Repast" "e253" -->
<a id="e253"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e253" class="eglink"><b>422</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e253" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Mr. Burns' Repast</span></b></a><br />Letting the player guess types for an unidentifiable fish.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_2.html#e253"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example253">
<p>Suppose we have an unhappily mutated fish that the player can refer to by any of a number of species names, or any word followed by -fish. We want to reject these commands, but preserve a memory of what the player last tried to call the thing:</p>
<!-- START CODE "c8307_253" -->
<a id="c8307_253"></a><blockquote class="code"><p class="quoted">
 &quot;Mr. Burns' Repast&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8308_253" -->
<a id="c8308_253"></a><blockquote class="code"><p class="quoted">
Wharf is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8309_253" -->
<a id="c8309_253"></a><blockquote class="code"><p class="quoted">
There is an unknown fish in the Wharf. The unknown fish has some a text called the supposed name. The description of the unknown fish is &quot;The victim of heavy mutagens, this thing is not really recognizable as any species you know.&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8310_253" -->
<a id="c8310_253"></a><blockquote class="code"><p class="quoted">
Fish variety is a kind of value. The fish varieties are salmon, albacore, mackerel.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8311_253" -->
<a id="c8311_253"></a><blockquote class="code"><p class="quoted">
Rule for printing the name of the unknown fish:
<br />&#160;&#160;&#160;&#160;if the supposed name of the unknown fish is &quot;&quot;, say the printed name of the unknown fish;
<br />&#160;&#160;&#160;&#160;otherwise say the supposed name of the unknown fish.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8312_253" -->
<a id="c8312_253"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;if the unknown fish is visible and player's command matches the regular expression &quot;\b\w+fish&quot;:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;replace the regular expression &quot;.*(?=\b\w+fish)&quot; in N with &quot;&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now N is &quot;[N](?)&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the supposed name of the unknown fish is N;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;respond with doubt;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command;
<br />&#160;&#160;&#160;&#160;otherwise if the unknown fish is visible and the player's command includes &quot;[fish variety]&quot;:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now supposed name of the fish is &quot;[fish variety understood](?)&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;respond with doubt;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8313_253" -->
<a id="c8313_253"></a><blockquote class="code"><p class="quoted">
To respond with doubt:
<br />&#160;&#160;&#160;&#160;say &quot;You're not [italic type]sure[roman type] you're seeing any such thing.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8314_253" -->
<a id="c8314_253"></a><blockquote class="code"><p class="quoted">
Test me with &quot;get swordfish / look / touch monkfish / look / listen to tunafish / x fish / x salmon / look&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "423: Northstar" "e267" -->
<a id="e267"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e267" class="eglink"><b>423</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e267" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Northstar</span></b></a><br />Making Inform understand ASK JOSH TO TAKE INVENTORY as JOSH, TAKE INVENTORY. This requires us to use a regular expression on the player's command, replacing some of the content.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_7.html#e267"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example267">
<p>Most of the time, Inform understands commands to other characters when they take the form &quot;JOSH, TAKE INVENTORY&quot; or &quot;JOAN, WEAR THE ARMOR&quot;. But novice players might also try commands of the form ASK JOSH TO TAKE INVENTORY or ORDER JOAN TO WEAR THE ARMOR.</p>
<p>The easiest way to make Inform understand such commands is to meddle directly with the player's command, changing it into the format that the game will understand, as here:</p>
<!-- START CODE "c8315_267" -->
<a id="c8315_267"></a><blockquote class="code"><p class="quoted">
&quot;Northstar&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8316_267" -->
<a id="c8316_267"></a><blockquote class="code"><p class="quoted">
The Northstar Cafe is a room. &quot;The Northstar is crammed with its usual brunch crowd, and you were lucky to get a table at all. You are now awaiting the arrival of your ricotta pancakes.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8317_267" -->
<a id="c8317_267"></a><blockquote class="code"><p class="quoted">
Josh is a man in The Northstar Cafe. &quot;Josh is on his way past your table.&quot; The description of Josh is &quot;He is a waiter here, but you also know him socially, so he tends to be more chatty than the other waiters.&quot; A persuasion rule: persuasion succeeds.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8318_267" -->
<a id="c8318_267"></a><blockquote class="code"><p class="quoted">
After reading a command:
<br />&#160;&#160;&#160;&#160;let N be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;\b(ask|tell|order) (.+?) to (.+)&quot; in N with &quot;\2, \3&quot;;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to N.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8319_267" -->
<a id="c8319_267"></a><blockquote class="code"><p class="quoted">
Test me with &quot;ask Josh to take inventory / tell Josh to take inventory / order Josh to take inventory&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Note that we have to copy N back explicitly to replace the player's command.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "424: Cave-troll" "e69" -->
<a id="e69"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_20.html#e69" class="eglink"><b>424</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_20.html#e69" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Cave-troll</span></b></a><br />Determining that the command the player typed is invalid, editing it, and re-examining it to see whether it now reads correctly.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_6.html#e69"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example69">
<p>Novice players of interactive fiction, unfamiliar with its conventions, will often try to add extra phrases to a command that the game cannot properly parse: HIT DOOR WITH FIST, for instance, instead of HIT DOOR.</p>
<p>While we can deal with some of these instances by expanding our range of actions, at some point it becomes impossible to account for all the possible prepositional phrases that the player might want to tack on. So what do we do if we want to handle those appended bits of text sensibly?</p>
<p>We could go through and remove any piece of text containing &quot;with ...&quot; from the end of a player's command; the problem with that is that it overzealously lops off the ends of valid commands like UNLOCK DOOR WITH KEY, as well. So clearly we don't want to do this as part of the &quot;After reading a command...&quot; stage.</p>
<p>A better time to cut off the offending text is right before issuing a parser error. At that point, Inform has already determined that it definitely cannot parse the instruction as given, so we know that there's something wrong with it.</p>
<p>The next problem, though, is that after we've edited the player's text we want to feed the corrected version back to Inform and try once more to interpret it.</p>
<p>This is where we have a valid reason to write a new &quot;rule for reading a command&quot;. We will tell Inform that when we have just corrected the player's input to something new, it should not ask for a new command (by printing a prompt and waiting for another line of input); it should instead paste our stored corrected command back into &quot;the player's command&quot; and proceed as though that new text had just been typed.</p>
<p>Thanks to John Clemens for the specifics of the implementation.</p>
<!-- START CODE "c8320_69" -->
<a id="c8320_69"></a><blockquote class="code"><p class="quoted">
&quot;Cave-troll&quot; by JDC
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8321_69" -->
<a id="c8321_69"></a><blockquote class="code"><p class="quoted">
Section 1 - The Mechanism
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8322_69" -->
<a id="c8322_69"></a><blockquote class="code"><p class="quoted">
The last command is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8323_69" -->
<a id="c8323_69"></a><blockquote class="code"><p class="quoted">
The parser error flag is a truth state that varies. The parser error flag is false.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8324_69" -->
<a id="c8324_69"></a><blockquote class="code"><p class="quoted">
Rule for printing a parser error when the latest parser error is the only understood as far as error and the player's command matches the text &quot;with&quot;:
<br />&#160;&#160;&#160;&#160;now the last command is the player's command;
<br />&#160;&#160;&#160;&#160;now the parser error flag is true;
<br />&#160;&#160;&#160;&#160;let n be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;.* with (.*)&quot; in n with &quot;with \1&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;(ignoring the unnecessary words '[n]')[line break]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;with .*&quot; in the last command with &quot;&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8325_69" -->
<a id="c8325_69"></a><blockquote class="code"><p class="quoted">
Rule for reading a command when the parser error flag is true:
<br />&#160;&#160;&#160;&#160;now the parser error flag is false;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to the last command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8326_69" -->
<a id="c8326_69"></a><blockquote class="code"><p class="quoted">
Section 2 - The Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8327_69" -->
<a id="c8327_69"></a><blockquote class="code"><p class="quoted">
The Cave is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8328_69" -->
<a id="c8328_69"></a><blockquote class="code"><p class="quoted">
The troll is a man in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8329_69" -->
<a id="c8329_69"></a><blockquote class="code"><p class="quoted">
The player carries a sword.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8330_69" -->
<a id="c8330_69"></a><blockquote class="code"><p class="quoted">
The chest is a locked lockable container in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8331_69" -->
<a id="c8331_69"></a><blockquote class="code"><p class="quoted">
Test me with &quot;attack troll with sword / unlock chest with sword / attack troll as a test&quot;.
</p></blockquote>
<!-- END CODE -->
<p>A caveat about using this method in a larger game: &quot;parser error flag&quot; will not automatically control the behavior of any rules we might have written for Before reading a command... or After reading a command..., so they may now fire at inappropriate times. It is a good idea to check for parser error flag in those rules as well.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
</body>
</html>
