<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- Generated by indoc on 11 Aug 2016 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>Chapter 23: Figures, Sounds and Files</title>
</head>
<body class="paper papertint"><p class="chapterheading">Chapter 23: Figures, Sounds and Files</p>
<p class="chaptercontents"><a href="WI_23.html#s1" class="standardlink"><span class="chaptercontentsitem">§23.1. Beyond text</span></a>; <a href="WI_23.html#s2" class="standardlink"><span class="chaptercontentsitem">§23.2. How IF views pictures</span></a>; <a href="WI_23.html#s3" class="standardlink"><span class="chaptercontentsitem">§23.3. Virtual machines and story file formats</span></a>; <a href="WI_23.html#s4" class="standardlink"><span class="chaptercontentsitem">§23.4. Gathering the figures</span></a>; <a href="WI_23.html#s5" class="standardlink"><span class="chaptercontentsitem">§23.5. Declaring and previewing the figures</span></a>; <a href="WI_23.html#s6" class="standardlink"><span class="chaptercontentsitem">§23.6. Displaying the figures</span></a>; <a href="WI_23.html#s7" class="standardlink"><span class="chaptercontentsitem">§23.7. Recorded sounds</span></a>; <a href="WI_23.html#s8" class="standardlink"><span class="chaptercontentsitem">§23.8. Declaring and playing back sounds</span></a>; <a href="WI_23.html#s9" class="standardlink"><span class="chaptercontentsitem">§23.9. Providing accessibility text</span></a>; <a href="WI_23.html#s10" class="standardlink"><span class="chaptercontentsitem">§23.10. Some technicalities about figures and sounds</span></a>; <a href="WI_23.html#s11" class="standardlink"><span class="chaptercontentsitem">§23.11. Files</span></a>; <a href="WI_23.html#s12" class="standardlink"><span class="chaptercontentsitem">§23.12. Declaring files</span></a>; <a href="WI_23.html#s13" class="standardlink"><span class="chaptercontentsitem">§23.13. Writing and reading tables to external files</span></a>; <a href="WI_23.html#s14" class="standardlink"><span class="chaptercontentsitem">§23.14. Writing, reading and appending text to files</span></a>; <a href="WI_23.html#s15" class="standardlink"><span class="chaptercontentsitem">§23.15. Exchanging files with other programs</span></a></p><table class="centredtable"><tr><td class="roadsigndirection"><a href="WI_1.html" class="standardlink"><img alt="arrow-up-left.png" src="images/arrow-up-left.png" /></a></td><td><a href="WI_1.html" class="standardlink">Contents of <i>Writing with Inform</i></a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_22.html" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_22.html" class="standardlink">Chapter 22: Advanced Phrases</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_24.html" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_24.html" class="standardlink">Chapter 24: Testing and Debugging</a></td></tr>
<tr><td class="roadsigndirection"><a href="examples_alphabetical.html" class="standardlink"><img alt="arrow-down-right.png" src="images/arrow-down-right.png" /></a></td><td><a href="examples_alphabetical.html" class="standardlink">Indexes of the examples</a></td></tr>
</table><p class="sectionheading"><a id="s1"></a>§23.1. Beyond text</p>
<p>In this chapter, we explore a number of ways to go beyond the traditional text-only, one-story-file-only model for IF.</p>
<p>These relatively exotic features are more demanding of the interpreter which a player uses than a plain text story file would be. They can only be used if the project is being compiled to the Glulx story file format (see the Settings panel for the project), and even then, the player will need to have a good Glulx interpreter - one which is reasonably up to date and well-written, that is - to be sure of everything working as intended.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_22.html#s10" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_22.html#s10" class="standardlink">Back to Chapter 22: Advanced Phrases: §22.10. Ambiguities</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s2" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s2" class="standardlink">Onward to §23.2. How IF views pictures</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s2"></a>§23.2. How IF views pictures</p>
<p>Looking around a bookshop, perhaps half of all the books published have illustrations. The proportion may be lower for novels, but if we count maps or other occasional diagrams, even the fiction section turns out to be surprisingly pictorial. Illustrations do not suit every book, but they are an option we would like to have available.</p>
<p>In the cultural history of IF, graphics in text adventures have sometimes been looked at with suspicion. Mostly this is because attempts in the 1980s were not very successful, because computer graphics were so poor then (by modern standards). It may be that some people also felt that the takeover of computer games by graphical interfaces was the death knell of IF. But pictures are now rendered in superb quality by computers, and the death of IF turned out to be an exaggeration, so it is time to move on.</p>
<p>Whether to have illustrations ought to be an artistic choice, like whether to include a romantic sub-plot or how much of the back story is revealed. But there are practical considerations too. The most successful illustrated books are those whose pictures are well-chosen, have a sense of design to them, and above all are consistent. Consider how much worse off <span class="italic">Winnie the Pooh</span> would have been if a selection of random teddy-bear drawings had been used, instead of E. H. Shepherd's beautifully conceived world; or a cookery book in which the recipes are all photographed at different distances and light levels. IF writers  may want to look for collaborators with a visual eye, just as most novelists do not draw their own illustrations.</p>
<p>Another consideration is that displaying images is more complicated for computers than displaying text. Not all devices can show pictures (consider handheld gadgets) and if they do, they may use different colour ranges or resolutions. So IF with pictures is always just a bit less portable than IF without, and because of that we must next look again at IF story file formats.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s1" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s1" class="standardlink">Back to §23.1. Beyond text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s3" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s3" class="standardlink">Onward to §23.3. Virtual machines and story file formats</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s3"></a>§23.3. Virtual machines and story file formats</p>
<p>Back in Chapter 2, we saw that the Settings panel allows any given Inform project to be produced in either of two possible story file formats. Recall that story files are the released IF works: what the player sees. The source text, the Index, and so on are not part of this.</p>
<p>A story file is not like a word-processed document, or a photograph. There are many rival formats for these - for instance, an image on a web page might be in JPEG or PNG format, among many others - but basically they are simple things for the reader to look at, and see everything in one go. An IF story file is more complicated, because the &quot;reader&quot; reacts to it, types in to it, is surprised by it, never quite knows what might happen next.</p>
<p>A story file is in fact a computer program in its own right, but not a program like iTunes or Firefox which runs on a typical home or business computer. Instead it is a program for an imaginary computer, called a &quot;virtual machine&quot; or &quot;VM&quot;. This has a design ideally suited to IF, and it would be the perfect IF player's computer if only it actually existed. Because it doesn't, the player instead runs an &quot;interpreter&quot; program like Windows Glulxe or Zoom or Spatterlight - and this one is a program like iTunes or Firefox - and the interpreter acts as a middle-man. It creates a software version of the virtual machine, and then runs the IF story file on that VM. This sounds slow and impractical, but in fact it works well, and is also much safer since programs on the VM are not allowed to touch the real computer - so they cannot at all easily contain viruses or other malware. (In theory a malicious story file might try to exploit a bug in one of the various VM implementations in use, just as malicious image files have been used to attack bugs in web browsers, but this has never in practice happened. Nothing can be absolutely safe, but a story file belongs in the &quot;mostly harmless&quot; category of files - like images - rather than the &quot;how far do you trust this person?&quot; category - like programs.)</p>
<p>The different formats of story file are programs for different virtual machines. Just as Windows and Mac OS X offer basically similar services to the user but are very different in appearance and their workings, so the different VMs are quite different. Some can display pictures, others not.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s2" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s2" class="standardlink">Back to §23.2. How IF views pictures</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s4" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s4" class="standardlink">Onward to §23.4. Gathering the figures</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s4"></a>§23.4. Gathering the figures</p>
<p>Inform provides basic support for displaying pictures and leaves more exotic effects for Extensions to provide. But either way, for reasons explained in the previous section, <span class="boldface">we can only have pictures if the Settings for the project are set to the Glulx story file format</span>.</p>
<p>Inform calls these pictures &quot;figures&quot;, following the usual Inform analogy with books. We will think of our work of IF as being like a mostly textual book which in broken up with illustrations here and there - Figure 1, Figure 2, and so on. These might be used to mark each new chapter of the plot, or each new location: whatever the author would like. So the first thing we need to do is decide when pictures should appear.</p>
<p>The second thing to do is to get hold of the pictures we want to use. These might be photographs, or artwork, or diagrams: anything, really, but we will need them to be in either JPEG or PNG format. Inform does not itself try to be an image editor, or an artwork program - there are many such programs already which do these things much better than Inform could.</p>
<p>The pictures then need to be put in a special place where Inform can reach them. Suppose the Inform project is called Example.inform. Then we need to create a folder alongside it called &quot;Example.materials&quot;, and create a further folder inside that called &quot;Figures&quot;. The actual images go inside &quot;Figures&quot;. So we might then have files like so:</p>
<!-- START CODE "c8739" -->
<a id="c8739"></a><blockquote class="code"><p class="quoted">
Example.inform
<br />Example.materials
<br />&#160;&#160;&#160;&#160;Figures
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Woodlands.png
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Blackberry.jpg
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Red Admiral Butterfly.png
</p></blockquote>
<!-- END CODE -->
<p>The &quot;.materials&quot; folder for an Inform project will turn out to have many other uses in the chapter on Publishing, and will be explained further there.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s3" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s3" class="standardlink">Back to §23.3. Virtual machines and story file formats</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s5" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s5" class="standardlink">Onward to §23.5. Declaring and previewing the figures</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s5"></a>§23.5. Declaring and previewing the figures</p>
<p>Inside Inform, the source text for a project always tries to avoid talking about filenames - we need a better way to refer to the individual figures.</p>
<p>We do this by declaring each figure with a sentence like the following examples:</p>
<!-- START CODE "c8740" -->
<a id="c8740"></a><blockquote class="code"><p class="quoted">
Figure of Woodlands is the file &quot;Woodlands.png&quot;.
<br />Figure 2 is the file &quot;Red Admiral Butterfly.png&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Figure names can consist of any text provided that text starts with the word &quot;Figure&quot;. So &quot;Figure 3 - Woodlands&quot;, for instance, or even &quot;Figure W&quot; would have been just as good as &quot;Figure of Woodlands&quot;. Books tend to number figures, but then, in a book the order in which they appear is known in advance - which might not be true in IF.</p>
<p>The file names must be exactly those used in the Figures folder. We need not declare every image kept there, but those we don't declare - remember Blackberry.jpg? - cannot be displayed.</p>
<p>We can preview the stock of figures by going to the table of figures in the Contents index for a project (once the project has been built, that is, so that its index is up to date). This preview shows thumbnail forms of the pictures, the names, the formats and the image sizes in pixels. A warning triangle is shown for any images in the wrong format, or which are missing from the Figures folder.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s4" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s4" class="standardlink">Back to §23.4. Gathering the figures</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s6" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s6" class="standardlink">Onward to §23.6. Displaying the figures</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s6"></a>§23.6. Displaying the figures</p>
<p>Inform's basic picture support simply allows figures to be shown at particular times. Once seen, they scroll away, just as text does once it has been printed. These pictures are really part of the stream of narrative. (If we would like icons or other images to be permanently present on screen, and divide the screen up in pictorial ways to achieve interesting layouts, we need to use special extensions to access Glulx's more exotic features.)</p>
<p>Displaying a picture is therefore like printing some text. Rather than</p>
<!-- START CODE "c8741" -->
<a id="c8741"></a><blockquote class="code"><p class="quoted">
say &quot;The woodlands stretch from here to the horizon.&quot;;
</p></blockquote>
<!-- END CODE -->
<p>we would use:</p>
<!-- START PHRASE "defn365" -->
<div class="definition"><a id="defn365"></a><p class="defnprototype"><b>display </b>(figure name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_displayfigure -->

<p>This phrase causes the figure to be displayed in a way visible to the player. If the option &quot;one time only&quot; is used, it will have no effect if the figure has been displayed before. Example:</p>
<!-- START CODE "c8742" -->
<a id="c8742"></a><blockquote class="code"><p class="quoted">
display the Figure of Woodlands;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>Once again, note that the &quot;display&quot; phrase does nothing unless the Settings for the project are set to the Glulx story file format. When a Glulx work is released as a blorb (the default setting for the way releases occur: see the chapter on Publishing), all the images used are automatically included.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s5" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s5" class="standardlink">Back to §23.5. Declaring and previewing the figures</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s7" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s7" class="standardlink">Onward to §23.7. Recorded sounds</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s7"></a>§23.7. Recorded sounds</p>
<p>Inform also supports the playing back of recorded sounds, which might be anything from a three-second sound effect for a creaking door to an epic orchestral symphony. <span class="boldface">Sound support is very newly added to the system and work is still in progress. In particular, sounds are not played by Inform for OS X (although it does produce valid blorbed Glulx story files), though they should be audible from within the Inform application for Windows.</span></p>
<p>Once again, sound effects are supported by Inform 7 only on the Glulx platform, and even then we must be prepared for the fact that not all interpreters will be able to play them back. We must also bear in mind that a sound recording is a large pile of bits, and that adding any kind of sounds will greatly increase the size of the Blorb file for the released Glulx story file.</p>
<p>The sound files provided must have one of two formats: AIFF or Ogg Vorbis. <span class="boldface">AIFF</span> is a traditional format in the recording industry, though it is more familiar to Mac OS X users than Windows users. It is uncompressed, giving what can be excellent audio quality, but at the cost of sometimes enormous file sizes - perhaps as much as 10 MB per minute, though this can be greatly reduced by lowering the sampling frequency, and halved again by dropping from stereo to mono.</p>
<p>Except for very short sound effects, we recommend using <span class="boldface">Ogg Vorbis</span> instead. This is a compressed format whose file sizes will typically be more like 1 MB per minute. Inform uses Ogg Vorbis as the only format safe from licencing and patent disputes. (We would very much have liked to provide MP3 support, but this is no longer legally possible for free software.)</p>
<p>Support for Ogg Vorbis is not built in to either Windows or Mac OS X, and any sound recording you make will probably have to be made first to another format (perhaps AIFF or WAV), and then converted. See <span class="boldface">www.vorbis.com</span> for encoding software which can convert from other sound formats to Vorbis.</p>
<p>Lastly, it must be remembered that recording industry bodies are very hostile to established copyright law covering fair use, parody, quotation of insubstantial passages, etc., when it comes to mixing or using commercially released music. They are well-resourced and highly litigious. If you use sound effects not originated by yourself, you do so at your own risk, even if what you do is perfectly legal on any reading of the statutes.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s6" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s6" class="standardlink">Back to §23.6. Displaying the figures</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s8" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s8" class="standardlink">Onward to §23.8. Declaring and playing back sounds</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s8"></a>§23.8. Declaring and playing back sounds</p>
<p>Sound effects are accommodated on the same basis as illustrations. The relevant media files need to be placed in a subfolder of the project's &quot;.materials&quot; folder, but this time called Sounds rather than Figures, so for instance:</p>
<!-- START CODE "c8743" -->
<a id="c8743"></a><blockquote class="code"><p class="quoted">
Example.inform
<br />Example.materials
<br />&#160;&#160;&#160;&#160;Figures
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Woodlands.png
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Blackberry.jpg
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Red Admiral Butterfly.png
<br />&#160;&#160;&#160;&#160;Sounds
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Rustling leaves.ogg
</p></blockquote>
<!-- END CODE -->
<p>Again, these must be declared in the source text:</p>
<!-- START CODE "c8744" -->
<a id="c8744"></a><blockquote class="code"><p class="quoted">
Sound of rustling leaves is the file &quot;Rustling leaves.ogg&quot;.
</p></blockquote>
<!-- END CODE -->
<p>And they can be played using a special phrase:</p>
<!-- START PHRASE "defn366" -->
<div class="definition"><a id="defn366"></a><p class="defnprototype"><b>play </b>(sound name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_playsf -->

<p>This phrase causes the sound effect to be played. If the option &quot;one time only&quot; is used, it will have no effect if the sound effect has been played before. Example:</p>
<!-- START CODE "c8745" -->
<a id="c8745"></a><blockquote class="code"><p class="quoted">
play the sound of rustling leaves;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s7" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s7" class="standardlink">Back to §23.7. Recorded sounds</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s9" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s9" class="standardlink">Onward to §23.9. Providing accessibility text</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s9"></a>§23.9. Providing accessibility text</p>
<p>It's conventional for web pages to provide &quot;alt-text&quot; for significant images displayed, so that partially sighted or blind users can get an idea of what is being shown. Inform allows figures to be given these short descriptions like so:</p>
<!-- START CODE "c8746" -->
<a id="c8746"></a><blockquote class="code"><p class="quoted">
Figure 2 is the file &quot;butterfly.jpg&quot; (&quot;A red admiral butterfly.&quot;).
</p></blockquote>
<!-- END CODE -->
<p>As we'll see, the same can be done for the cover image:</p>
<!-- START CODE "c8747" -->
<a id="c8747"></a><blockquote class="code"><p class="quoted">
Release along with cover art (&quot;A cathedral at sunset.&quot;).
</p></blockquote>
<!-- END CODE -->
<p>And also for sounds:</p>
<!-- START CODE "c8748" -->
<a id="c8748"></a><blockquote class="code"><p class="quoted">
Fugue is the file &quot;Bach.ogg&quot; (&quot;A church organ playing a Bach fugue.&quot;).
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s8" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s8" class="standardlink">Back to §23.8. Declaring and playing back sounds</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s10" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s10" class="standardlink">Onward to §23.10. Some technicalities about figures and sounds</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s10"></a>§23.10. Some technicalities about figures and sounds</p>
<p>(i) Names for figures, such as &quot;Figure of Woodlands&quot;, are values for a special kind of value called &quot;figure name&quot;. This can in turn be used to define variables, properties and phrases:</p>
<!-- START CODE "c8749" -->
<a id="c8749"></a><blockquote class="code"><p class="quoted">
The turn card image is a figure name that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8750" -->
<a id="c8750"></a><blockquote class="code"><p class="quoted">
An Old Master is a kind of thing. An Old Master has a figure name called appearance. Figure 1 is the file &quot;Giaconda.jpg&quot;. The Mona Lisa is an Old Master. The appearance of the Mona Lisa is Figure 1.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8751" -->
<a id="c8751"></a><blockquote class="code"><p class="quoted">
To place (F - a figure name) in the gallery: ...
</p></blockquote>
<!-- END CODE -->
<p>(ii) Similarly, names for sound effects, such as &quot;Sound of rustling leaves&quot;, are values for the kind of value &quot;sound name&quot;.</p>
<p>(iii) In the released, blorbed-up Glulx file, figures and sound effects are internally given resource ID numbers which count upwards from 2 in order of their declaration. (Figure and sound numbers can thus be intermingled, if their declarations are.) Resource ID number 1 is reserved for the image of the cover art, if there is any. (See the chapter on Publishing.) To obtain these numbers, if we need them, we can use:</p>
<!-- START PHRASE "defn367" -->
<div class="definition"><a id="defn367"></a><p class="defnprototype"><b>Glulx resource ID of </b>(figure name)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_figureid -->

<p>This phrase produces the ID number used in the eventual Glulx file for the given figure.</p>

<!-- end definition -->
</div>

<!-- START PHRASE "defn368" -->
<div class="definition"><a id="defn368"></a><p class="defnprototype"><b>Glulx resource ID of </b>(sound name)<b> ... number</b></p>
<!-- END PHRASE -->
<!-- definition of ph_soundid -->

<p>This phrase produces the ID number used in the eventual Glulx file for the given sound effect.</p>

<!-- end definition -->
</div>

<p>(iv) Glulx hackers may also like to know that whenever Inform 7 builds a project for Glulx, the Inform 6 code it generates always contains a full copy of John Cater's definitive header file &quot;infglk.h&quot;.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s9" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s9" class="standardlink">Back to §23.9. Providing accessibility text</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s11" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s11" class="standardlink">Onward to §23.11. Files</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s11"></a>§23.11. Files</p>
<p>Once an Inform project is released, it is playable as a &quot;story file&quot;, which is in effect a computer program for a specially IF-adapted design of computer. Story files run in what in computing is sometimes called a &quot;sandbox&quot;, a kind of safe play area where it can be guaranteed that they cannot do any harm. This is good, because it means a story file can't be infected with viruses or other malware. If the project's Settings panel has the story file format set to the Z-machine, the story file is so thoroughly boxed in that it cannot even see the bigger computer beyond: it lives in a world of its own. But the Glulx format opens the door a crack, allowing the story file to read and write a small number of data files, which live in a single folder on the bigger computer's hard drive.</p>
<p>Why might we want this? Among the reasons are -</p>
<!-- START CODE "c8752" -->
<a id="c8752"></a><blockquote class="code"><p class="quoted">
- to remember what has happened in previous attempts by the player;
<br />- to store the player's preferences;
<br />- in a two-part story, where each part is an independently released story file, to allow Part I to save some information about its ending which Part II could then pick up and make use of;
<br />- to communicate with some external program, such as an Internet service.
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s10" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s10" class="standardlink">Back to §23.10. Some technicalities about figures and sounds</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s12" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s12" class="standardlink">Onward to §23.12. Declaring files</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s12"></a>§23.12. Declaring files</p>
<p>Like figures and sounds, files must be declared before they can be used. For instance:</p>
<!-- START CODE "c8753" -->
<a id="c8753"></a><blockquote class="code"><p class="quoted">
The File of Glaciers is called &quot;ice&quot;.
</p></blockquote>
<!-- END CODE -->
<p>This creates a new named constant &quot;File of Glaciers&quot; to refer to the file, throughout the source text. We use this name for it whether or not the actual disc file exists yet: it might be one that will only be created if something unusual happens in play, for instance.</p>
<p>Quoted filenames should contain only letters and digits, should be 23 characters or fewer, and should begin with a letter. (In particular they can contain no slashes or dots - no subfolders or extensions can be indicated.) The actual filename this translates to will vary from platform to platform, but &quot;ice.glkdata&quot; is typical, stored in some sensible folder.</p>
<p>Every file has an owner - not a person, but the project which normally writes to it. Inform assumes that the current project will be owning any file which it declares - the File of Glaciers, for instance. But we can optionally specify that it is owned by somebody else:</p>
<!-- START CODE "c8754" -->
<a id="c8754"></a><blockquote class="code"><p class="quoted">
The file of Boundaries (owned by another project) is called &quot;milnor&quot;.
<br />The file of Spectral Sequences (owned by project &quot;4122DDA8-A153-46BC-8F57-42220F9D8795&quot;) is called &quot;adams&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Inform uses ownership to make sure that we do not accidentally read in a file which has nothing to do with us, but merely happens to use the same name. Thus it is an error to read a file whose ownership does not agree with our declaration. Saying that a file is owned by &quot;another project&quot; allows us to read it whatever the owner is (so this can be used for files shared between multiple projects); specifying exactly where it needs to come from allows us to pass information from one project to another. Note that we identify projects using the IFID number - this can be found in the Contents index for a project, or by typing VERSION during play; see the chapter on Publishing for more about IFIDs.</p>
<p>Files are indexed in the Contents index, alongside figures and sound effects.</p>
<p>Two technicalities. First, constants such as &quot;File of Glaciers&quot; are of a kind of value called &quot;external file&quot; (compare &quot;figure name&quot; and &quot;sound name&quot;). Second, Inform's file-handling is provided for the Glulx machine, which in turn uses the Glk interface. This allows for either text or binary files. Inform's higher-level phrases to do with files, described in this chapter, all use text files, and all declared files are text files by default. But we can optionally add the keyword &quot;binary&quot; to declare a binary file, if needed:</p>
<!-- START CODE "c8755" -->
<a id="c8755"></a><blockquote class="code"><p class="quoted">
The binary File of Glaciation Data is called &quot;icedata&quot;.
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s11" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s11" class="standardlink">Back to §23.11. Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s13" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s13" class="standardlink">Onward to §23.13. Writing and reading tables to external files</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s13"></a>§23.13. Writing and reading tables to external files</p>
<p>The main use for files is to store and retrieve data, and the most flexible form of data used by Inform is the Table, so facilities are provided which make it as easy as possible to write and read the contents of a table to files. If so, the file must contain just one single table: so to write multiple tables, we need to write multiple files, one for each.</p>
<p>To save the contents of a table to a file, we use the phrase:</p>
<!-- START PHRASE "defn369" -->
<div class="definition"><a id="defn369"></a><p class="defnprototype"><b>write </b>(external file)<b> from </b>(table name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_writetable -->

<p>This phrase causes the entire contents of the given table to be written out to the given file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c8756" -->
<a id="c8756"></a><blockquote class="code"><p class="quoted">
write File of Glaciation Data from the Table of Antarctic Reserves
</p></blockquote>
<!-- END CODE -->
<p>Any blank rows in the table are automatically moved to the bottom, and only the non-blank rows are written.</p>

<!-- end definition -->
</div>

<p>To load a file back into a table,</p>
<!-- START PHRASE "defn370" -->
<div class="definition"><a id="defn370"></a><p class="defnprototype"><b>read </b>(external file)<b> into </b>(table name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_readtable -->

<p>This phrase causes the entire contents of the given table to be read in from the given file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c8757" -->
<a id="c8757"></a><blockquote class="code"><p class="quoted">
read File of Glaciation Data into the Table of Antarctic Reserves
</p></blockquote>
<!-- END CODE -->
<p>Any rows left spare at the foot of the table are automatically blanked. On the other hand if the file is too large to fit into the table - with too many columns or too many rows - a run-time problem is produced.</p>

<!-- end definition -->
</div>

<p>We can check if a file already exists using:</p>
<!-- START PHRASE "defn371" -->
<div class="definition"><a id="defn371"></a><p class="defnprototype"><b>if </b>(external file)<b> exists:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_fileexists -->

<p>This condition is true if the file-system used by the player appears to contain a file with the right name. For example, if we declared:</p>
<!-- START CODE "c8758" -->
<a id="c8758"></a><blockquote class="code"><p class="quoted">
The binary File of Glaciation Data is called &quot;icedata&quot;.
</p></blockquote>
<!-- END CODE -->
<p>and then tested</p>
<!-- START CODE "c8759" -->
<a id="c8759"></a><blockquote class="code"><p class="quoted">
if the File of Glaciation Data exists, ...
</p></blockquote>
<!-- END CODE -->
<p>then Inform would search for a file called &quot;icedata&quot;. (The arrangements for where this might be stored, and its filename extension, vary from platform to platform.)</p>

<!-- end definition -->
</div>

<p>One unfortunate restriction must be kept in mind. Some of what is stored in tables is solid information whose meaning never changes: the number 342, for instance, means the same to everyone. But other information depends entirely on the current location of certain structures in memory - for instance, a rule is internally referred to by its memory location. This potentially changes each time Go or Replay is clicked, and so it is not safe to pass it from one copy to another, or from one project to another. The only tables which Inform allows us to write into files are those containing &quot;safe&quot; data: numbers, units, times of day and kinds of value with named alternatives. Scenes, rules or rulebooks, in particular, are not allowed.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s12" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s12" class="standardlink">Back to §23.12. Declaring files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s14" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s14" class="standardlink">Onward to §23.14. Writing, reading and appending text to files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e5" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e5" class="standardlink">Example 440: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Alien Invasion Part 23</b>&#160;&#160;&#160; Keeping a preference file that could be loaded by any game in a series.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e211" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e211" class="standardlink">Example 441: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Labyrinth of Ghosts</b>&#160;&#160;&#160; Remembering the fates of all previous explorers of the labyrinth.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e335" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e335" class="standardlink">Example 442: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Rubies</b>&#160;&#160;&#160; A scoreboard that keeps track of the ten highest-scoring players from one playthrough to the next, adding the player's name if he has done well enough.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s14"></a>§23.14. Writing, reading and appending text to files</p>
<p>Text can also be saved to a file, and again all file-handling is automatic:</p>
<!-- START PHRASE "defn372" -->
<div class="definition"><a id="defn372"></a><p class="defnprototype"><b>write </b>(text)<b> to </b>(external file)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_writetext -->

<p>This phrase makes the given text become the entire contents of the named file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c8760" -->
<a id="c8760"></a><blockquote class="code"><p class="quoted">
write &quot;Jackdaws love my big sphinx of quartz.&quot; to the file of Abecedary Wisdom;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn373" -->
<div class="definition"><a id="defn373"></a><p class="defnprototype"><b>append </b>(text)<b> to </b>(external file)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_appendtext -->

<p>This phrase adds the given text to the end of the current contents of the named file (creating it if it does not exist on disc). Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c8761" -->
<a id="c8761"></a><blockquote class="code"><p class="quoted">
append &quot;Jinxed wizards pluck ivy from the big quilt.&quot; to the file of Abecedary Wisdom;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>The quoted text can, of course, contain substitutions, so can be long and complex if need be.</p>
<p>Text from a file is printed back with the text substitution:</p>
<!-- START PHRASE "defn374" -->
<div class="definition"><a id="defn374"></a><p class="defnprototype"><b>say &quot;[text of </b>(external file)<b>]&quot;</b></p>
<!-- END PHRASE -->
<!-- definition of ph_saytext -->

<p>This text expands to the contents of the named file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c8762" -->
<a id="c8762"></a><blockquote class="code"><p class="quoted">
&quot;[text of the File of Abecedary Wisdom]&quot;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>To copy one file to another, for instance,</p>
<!-- START CODE "c8763" -->
<a id="c8763"></a><blockquote class="code"><p class="quoted">
write &quot;[text of the file of Abecedary Wisdom]&quot; to the file of Secondary Wisdom;
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s13" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s13" class="standardlink">Back to §23.13. Writing and reading tables to external files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s15" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_23.html#s15" class="standardlink">Onward to §23.15. Exchanging files with other programs</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e157" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e157" class="standardlink">Example 443: <img class="asterisk" alt="*" src="images/asterisk.png" /> <b>The Fourth Body</b>&#160;&#160;&#160; Notebooks in which the player can record assorted notes throughout play.</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e142" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e142" class="standardlink">Example 444: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>The Fifth Body</b>&#160;&#160;&#160; An expansion on the notebook, allowing the player somewhat more room in which to type his recorded remark.</a></td></tr>
</table><hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
<p class="sectionheading"><a id="s15"></a>§23.15. Exchanging files with other programs</p>
<p>Provided we declare the files in the right way, it is easy for one project to read a file created by another project.</p>
<p>But if we want more rapid communication, between two projects which are each playing at the same time, we need to be more careful. What if project A tries to read the file at the same moment that project B is writing it?</p>
<p>To avoid this, we have a concept of files being &quot;ready&quot;. A file is ready if it exists, and is completely written, and not in use elsewhere. We have already seen:</p>
<!-- START CODE "c8764" -->
<a id="c8764"></a><blockquote class="code"><p class="quoted">
if the file of Invariants exists...
</p></blockquote>
<!-- END CODE -->
<p>But now we want a stronger condition:</p>
<!-- START PHRASE "defn375" -->
<div class="definition"><a id="defn375"></a><p class="defnprototype"><b>if ready to read </b>(external file)<b>:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_fileready -->

<p>This condition is true if the file exists and is marked as being ready to read; that is, it is not in a state where another program is currently writing it. Example:</p>
<!-- START CODE "c8765" -->
<a id="c8765"></a><blockquote class="code"><p class="quoted">
if ready to read the file of Invariants, ...
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>A file cannot be ready to read if it does not exist, so this is a stronger condition. If A and B are attempting communication in real time, both running at once, then Project A should check that an external file owned by B is ready before it tries to read it. Files can also be marked as ready or not ready, in effect claiming them, thus:</p>
<!-- START PHRASE "defn376" -->
<div class="definition"><a id="defn376"></a><p class="defnprototype"><b>mark </b>(external file)<b> as ready to read</b></p>
<!-- END PHRASE -->
<!-- definition of ph_markfileready -->

<p>This phrase marks that we have finished writing to the given file, so that any external program is welcome to read it now. Example:</p>
<!-- START CODE "c8766" -->
<a id="c8766"></a><blockquote class="code"><p class="quoted">
mark the file of Invariants as ready to read;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<!-- START PHRASE "defn377" -->
<div class="definition"><a id="defn377"></a><p class="defnprototype"><b>mark </b>(external file)<b> as not ready to read</b></p>
<!-- END PHRASE -->
<!-- definition of ph_markfilenotready -->

<p>This phrase marks that we are about to start writing to the given file, so that any external program should wait until we're finished if it wants to read the file. Example:</p>
<!-- START CODE "c8767" -->
<a id="c8767"></a><blockquote class="code"><p class="quoted">
mark the file of Invariants as not ready to read;
</p></blockquote>
<!-- END CODE -->

<!-- end definition -->
</div>

<p>Possibilities really begin to open up when project A is our story file, but B is not another story file at all: it is some external program such as a Web service, say. (Of course this is harder to set up, since the player needs to have both A and B running at the same time, but for stories running on an Internet server this can all be made seamless.)</p>
<p>When Inform begins writing a table, or text, to a file, it initially marks the file as not ready: only when the table or text is completely written and the file about to close is the file marked as ready.</p>
<p>In order to write non-story-file programs as B, communicating with story files as A, we need to know the file format used by Inform. An Inform file is currently a Unix text file (with 10 as the line division character), encoded as ASCII Latin-1. (We would like to use Unicode at some point in the future, but the Glk and Glulx layers are still not fully converted to Unicode.) It opens with a single header line in the form:</p>
<!-- START CODE "c8768" -->
<a id="c8768"></a><blockquote class="code"><p class="quoted">
* //IFID// leafname
</p></blockquote>
<!-- END CODE -->
<p>The opening character is an asterisk if the file is currently ready, a hyphen if the file is currently not ready. The IFID between the slashes is the IFID number of the project which last wrote to the file. (Marking &quot;ready&quot; or &quot;not ready&quot; does not count as a write for this purpose.) If an external program wrote the file, it should call itself something which will not clash with any story file's IFID. The leafname is the filename text used inside the story file where the file was declared. For instance:</p>
<!-- START CODE "c8769" -->
<a id="c8769"></a><blockquote class="code"><p class="quoted">
* //4122DDA8-A153-46BC-8F57-42220F9D8795// ice
</p></blockquote>
<!-- END CODE -->
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#s14" class="standardlink"><img alt="arrow-left.png" src="images/arrow-left.png" /></a></td><td><a href="WI_23.html#s14" class="standardlink">Back to §23.14. Writing, reading and appending text to files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_24.html#s1" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_24.html#s1" class="standardlink">Onward to Chapter 24: Testing and Debugging: §24.1. Checking against the Index</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23.html#e334" class="standardlink"><img alt="arrow-down.png" src="images/arrow-down.png" /></a></td><td><a href="WI_23.html#e334" class="standardlink">Example 445: <img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /> <b>Flathead News Network</b>&#160;&#160;&#160; Using external files, together with a simple Unix script running in the background, to provide live news headlines inside a story file.</a></td></tr>
</table><hr />
</div>
<div class="bookexamples">
<p class="chapterheading">Examples from Chapter 23: Figures, Sounds and Files</p><table class="centredtable"><tr><td class="roadsigndirection"><a href="WI_23.html" class="standardlink"><img alt="arrow-up.png" src="images/arrow-up.png" /></a></td><td><a href="WI_23.html" class="standardlink">Start of this chapter</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_24.html" class="standardlink"><img alt="arrow-right.png" src="images/arrow-right.png" /></a></td><td><a href="WI_24.html" class="standardlink">Chapter 24: Testing and Debugging</a></td></tr>
<tr><td class="roadsigndirection"><a href="examples_alphabetical.html" class="standardlink"><img alt="arrow-down-right.png" src="images/arrow-down-right.png" /></a></td><td><a href="examples_alphabetical.html" class="standardlink">Indexes of the examples</a></td></tr>
</table><!-- START EXAMPLE "440: Alien Invasion Part 23" "e5" -->
<a id="e5"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e5" class="eglink"><b>440</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e5" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Alien Invasion Part 23</span></b></a><br />Keeping a preference file that could be loaded by any game in a series.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_11.html#e5"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example5">
<p>Suppose that we have a series of games each of which allows the player to select a puzzle difficulty level. When the player plays a new game in the series, we want him to start out by default with the same difficulty level he faced earlier on, so we store this information in a small preferences file, as follows:</p>
<!-- START CODE "c8770_5" -->
<a id="c8770_5"></a><blockquote class="code"><p class="quoted">
&quot;Alien Invasion Part 23&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8771_5" -->
<a id="c8771_5"></a><blockquote class="code"><p class="quoted">
A difficulty is a kind of value. The difficulties are easy, moderate, hard, and fiendish.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8772_5" -->
<a id="c8772_5"></a><blockquote class="code"><p class="quoted">
Understand &quot;use [difficulty] puzzles&quot; as selecting difficulty. Selecting difficulty is an action out of world, applying to one difficulty.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8773_5" -->
<a id="c8773_5"></a><blockquote class="code"><p class="quoted">
Carry out selecting difficulty:
<br />&#160;&#160;&#160;&#160;choose row 1 in the Table of Preference Settings;
<br />&#160;&#160;&#160;&#160;now challenge level entry is difficulty understood;
<br />&#160;&#160;&#160;&#160;say &quot;Puzzles will be [challenge level entry] from now on.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8774_5" -->
<a id="c8774_5"></a><blockquote class="code"><p class="quoted">
The File of Preferences is called &quot;prefs&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8775_5" -->
<a id="c8775_5"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if File of Preferences exists:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;read File of Preferences into the Table of Preference Settings;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;choose row 1 in the Table of Preference Settings;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;(The current puzzle difficulty is set to [challenge level entry].)&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8776_5" -->
<a id="c8776_5"></a><blockquote class="code"><p class="quoted">
Check quitting the game:
<br />&#160;&#160;&#160;&#160;write File of Preferences from the Table of Preference Settings.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8777_5" -->
<a id="c8777_5"></a><blockquote class="code"><p class="quoted">
Table of Preference Settings
<br />challenge level
<br />easy
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8778_5" -->
<a id="c8778_5"></a><blockquote class="code"><p class="quoted">
The Sewer Junction is a room.
</p></blockquote>
<!-- END CODE -->
<p>Our preference file is restricted to a single option here for simplicity's sake, but we could keep track of more information -- whether the player preferred verbose or brief room descriptions, screen configurations, and so on.</p>
<p>If we were disposed to be somewhat crueler, we could use a similar method to make the player finish each episode of the series in order to &quot;unlock&quot; the next. All we would need to do is store a numerical password in our preferences file when the player finished a given level; the next level would check, say, the Table of Completed Levels for that password, and refuse to play unless the right number were present.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "441: Labyrinth of Ghosts" "e211" -->
<a id="e211"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e211" class="eglink"><b>441</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e211" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Labyrinth of Ghosts</span></b></a><br />Remembering the fates of all previous explorers of the labyrinth.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_11.html#e211"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example211">
<p>A tradition among Nethack-like computer games of the old school is that a player's death in a given place leaves a ghost behind to haunt subsequent players. Information about past lives is sometimes stored in a &quot;bones file&quot;, and in this example we do exactly that, for a grievously unfair little dungeon.</p>
<p>To begin with, the labyrinth itself. We create a kind of value to remember possible means of death in these tunnels, and we assign a coordinate position in some grid to each location. (We do this because grid positions can safely be stored in tables saved out to external files, whereas room names cannot - they represent data which changes each time we amend the source.)</p>
<!-- START CODE "c8779_211" -->
<a id="c8779_211"></a><blockquote class="code"><p class="quoted">
&quot;Labyrinth of Ghosts&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8780_211" -->
<a id="c8780_211"></a><blockquote class="code"><p class="quoted">
Use scoring.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8781_211" -->
<a id="c8781_211"></a><blockquote class="code"><p class="quoted">
A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8782_211" -->
<a id="c8782_211"></a><blockquote class="code"><p class="quoted">
A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8783_211" -->
<a id="c8783_211"></a><blockquote class="code"><p class="quoted">
The Gateway is a room. &quot;For the foolhardy adventurer, the perilous labyrinth lies north, east or south.&quot; The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. &quot;This partly fallen cave may perhaps extend further north.&quot; The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. &quot;No telling why this canyon is named after archery, but perhaps if you wait around you'll find out.&quot; The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8784_211" -->
<a id="c8784_211"></a><blockquote class="code"><p class="quoted">
Every turn when a random chance of 1 in 10 succeeds:
<br />&#160;&#160;&#160;&#160;say &quot;A dwarf appears out of nowhere, and throws a nasty little knife.&quot;;
<br />&#160;&#160;&#160;&#160;have the player slain.
</p></blockquote>
<!-- END CODE -->
<p>And as compensation for these hazards:</p>
<!-- START CODE "c8785_211" -->
<a id="c8785_211"></a><blockquote class="code"><p class="quoted">
Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8786_211" -->
<a id="c8786_211"></a><blockquote class="code"><p class="quoted">
Table of Point Values
<br />item 	  	score
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">silver bars</p></td><td class="quotedtablecell"><p class="quoted">3</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">platinum pyramid</p></td><td class="quotedtablecell"><p class="quoted">10</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">emerald</p></td><td class="quotedtablecell"><p class="quoted">4</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8787_211" -->
<a id="c8787_211"></a><blockquote class="code"><p class="quoted">
Report taking an item listed in the Table of Point Values:
<br />&#160;&#160;&#160;&#160;increase the score by the score entry;
<br />&#160;&#160;&#160;&#160;blank out the whole row.
</p></blockquote>
<!-- END CODE -->
<p>We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.</p>
<!-- START CODE "c8788_211" -->
<a id="c8788_211"></a><blockquote class="code"><p class="quoted">
Table of Ghostly Presences
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">haunted position</p></td><td class="quotedtablecell"><p class="quoted">score at death</p></td><td class="quotedtablecell"><p class="quoted">turns at death</p></td><td class="quotedtablecell"><p class="quoted">manner of death</p></td><td class="quotedtablecell"><p class="quoted">sequence</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">a grid location</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a demise</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">with 19 blank rows.</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.</p>
<!-- START CODE "c8789_211" -->
<a id="c8789_211"></a><blockquote class="code"><p class="quoted">
The File of Ghosts is called &quot;ghosts&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8790_211" -->
<a id="c8790_211"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;sort the Table of Ghostly Presences in sequence order.
</p></blockquote>
<!-- END CODE -->
<p>How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...</p>
<!-- START CODE "c8791_211" -->
<a id="c8791_211"></a><blockquote class="code"><p class="quoted">
After looking:
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences in reverse sequence order:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the haunted position entry is the coordinates of the location, say &quot;You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.&quot;
</p></blockquote>
<!-- END CODE -->
<p>(For instance, &quot;You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.&quot;) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)</p>
<!-- START CODE "c8792_211" -->
<a id="c8792_211"></a><blockquote class="code"><p class="quoted">
To have the player (sticky end - a demise):
<br />&#160;&#160;&#160;&#160;let the new sequence number be 0;
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let S be the sequence entry;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if S is greater than the new sequence number, let the new sequence number be S;
<br />&#160;&#160;&#160;&#160;increment the new sequence number;
<br />&#160;&#160;&#160;&#160;if the number of blank rows in the Table of Ghostly Presences is 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;choose row 1 in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blank out the whole row;
<br />&#160;&#160;&#160;&#160;choose a blank row in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the sequence entry is the new sequence number;
<br />&#160;&#160;&#160;&#160;now the manner of death entry is the sticky end;
<br />&#160;&#160;&#160;&#160;now the turns at death entry is the turn count;
<br />&#160;&#160;&#160;&#160;now the score at death entry is the score;
<br />&#160;&#160;&#160;&#160;now the haunted position entry is the coordinates of the location;
<br />&#160;&#160;&#160;&#160;write the File of Ghosts from the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the latest demise is the sticky end;
<br />&#160;&#160;&#160;&#160;end the story saying &quot;You have been [latest demise]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Strictly speaking we ought to worry that after 2,147,483,647 deaths, the sequence numbers would grow too large to store in a single value, and then the sequence of ghosts will be erratic. But it seems unlikely that anyone will play this example 2.1 billion times.</p>
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "442: Rubies" "e335" -->
<a id="e335"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e335" class="eglink"><b>442</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e335" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Rubies</span></b></a><br />A scoreboard that keeps track of the ten highest-scoring players from one playthrough to the next, adding the player's name if he has done well enough.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_11.html#e335"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example335">
<p>The trick here is that we need a table with text in order to keep track of the players' names.</p>
<p>Part 1 largely replicates the source from &quot;Identity Theft&quot;; new material starts at Part 2.</p>
<!-- START CODE "c8793_335" -->
<a id="c8793_335"></a><blockquote class="code"><p class="quoted">
 &quot;Rubies&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8794_335" -->
<a id="c8794_335"></a><blockquote class="code"><p class="quoted">
Use scoring.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8795_335" -->
<a id="c8795_335"></a><blockquote class="code"><p class="quoted">
Part 1 - Collecting Names
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8796_335" -->
<a id="c8796_335"></a><blockquote class="code"><p class="quoted">
The player's forename is a text that varies. The player's full name is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8797_335" -->
<a id="c8797_335"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;What is your name? &gt; &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8798_335" -->
<a id="c8798_335"></a><blockquote class="code"><p class="quoted">
To decide whether collecting names:
<br />&#160;&#160;&#160;&#160;if the command prompt is &quot;What is your name? &gt; &quot;, yes;
<br />&#160;&#160;&#160;&#160;no.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8799_335" -->
<a id="c8799_335"></a><blockquote class="code"><p class="quoted">
After reading a command when collecting names:
<br />&#160;&#160;&#160;&#160;if the number of words in the player's command is greater than 5:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[paragraph break]Who are you, a member of the British royal family? No one has that many names. Let's try this again.&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reject the player's command;
<br />&#160;&#160;&#160;&#160;now the player's full name is the player's command;
<br />&#160;&#160;&#160;&#160;now the player's forename is word number 1 in the player's command;
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;&gt;&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;Hi, [player's forename]!&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[banner text]&quot;;
<br />&#160;&#160;&#160;&#160;move the player to the location;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8800_335" -->
<a id="c8800_335"></a><blockquote class="code"><p class="quoted">
Instead of looking when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8801_335" -->
<a id="c8801_335"></a><blockquote class="code"><p class="quoted">
Rule for printing the banner text when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8802_335" -->
<a id="c8802_335"></a><blockquote class="code"><p class="quoted">
Rule for constructing the status line when collecting names: do nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8803_335" -->
<a id="c8803_335"></a><blockquote class="code"><p class="quoted">
Part 2 - Adding the Leaderboard
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8804_335" -->
<a id="c8804_335"></a><blockquote class="code"><p class="quoted">
File of Leaderboard is called &quot;leaderboard&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8805_335" -->
<a id="c8805_335"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if the File of Leaderboard exists:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;read File of Leaderboard into the Table of Leaders;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sort the Table of Leaders in reverse scored amount order.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8806_335" -->
<a id="c8806_335"></a><blockquote class="code"><p class="quoted">
When play ends:
<br />&#160;&#160;&#160;&#160;choose row 10 in the Table of Leaders; [we've sorted the table, so the lowest score will be the one at the bottom]
<br />&#160;&#160;&#160;&#160;if the score is greater than scored amount entry:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now name entry is the player's forename;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the scored amount entry is the score;
<br />&#160;&#160;&#160;&#160;show leaderboard;
<br />&#160;&#160;&#160;&#160;write the File of Leaderboard from the Table of Leaders.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8807_335" -->
<a id="c8807_335"></a><blockquote class="code"><p class="quoted">
To show leaderboard:
<br />&#160;&#160;&#160;&#160;sort the Table of Leaders in reverse scored amount order;
<br />&#160;&#160;&#160;&#160;say &quot;Current leading scores: [paragraph break]&quot;;
<br />&#160;&#160;&#160;&#160;say fixed letter spacing;
<br />&#160;&#160;&#160;&#160;repeat through Table of Leaders:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if scored amount entry is greater than 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;  [name entry]&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let N be 25 minus the number of characters in name entry; [here we want to space out the scores so they make a neat column]
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if N is less than 1, now N is 1;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say N spaces;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[scored amount entry][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say variable letter spacing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8808_335" -->
<a id="c8808_335"></a><blockquote class="code"><p class="quoted">
To say (N - a number) spaces:
<br />&#160;&#160;&#160;&#160;repeat with index running from 1 to N:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot; &quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8809_335" -->
<a id="c8809_335"></a><blockquote class="code"><p class="quoted">
Table of Leaders
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">scored amount</p></td><td class="quotedtablecell"><p class="quoted">name</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">0</p></td><td class="quotedtablecell"><p class="quoted">&quot;Smithee&quot;</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>And now we introduce a scenario that allows different players to come up with different scores -- admittedly not a very interesting scenario, but it will do for now:</p>
<!-- START CODE "c8810_335" -->
<a id="c8810_335"></a><blockquote class="code"><p class="quoted">
Part 3 - Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8811_335" -->
<a id="c8811_335"></a><blockquote class="code"><p class="quoted">
Carry out taking something which is not handled:
<br />&#160;&#160;&#160;&#160;increment score.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8812_335" -->
<a id="c8812_335"></a><blockquote class="code"><p class="quoted">
The Big Treasure Chamber is a room. It contains a ruby, an emerald, a gold tooth, an antique katana, and a silver coin.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8813_335" -->
<a id="c8813_335"></a><blockquote class="code"><p class="quoted">
Instead of waiting, end the story finally.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8814_335" -->
<a id="c8814_335"></a><blockquote class="code"><p class="quoted">
Test me with &quot;get ruby / z&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "443: The Fourth Body" "e157" -->
<a id="e157"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e157" class="eglink"><b>443</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e157" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">The Fourth Body</span></b></a><br />Notebooks in which the player can record assorted notes throughout play.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_9.html#e157"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example157">
<p>Some mystery games supply the player with an in-game system for taking notes, in case he doesn't want to rely on scraps of paper next to the computer. One way of doing this is to write out all the player's notes and observations into a notebook file, whose contents can be retrieved during play (or, indeed, after it).</p>
<p>We'll first invent a general system for writing text into notebooks, by creating a new kind called jotter. Each individual jotter will have its own disc file, and there will be basically three things which can be done with jotters: erasing, reading and writing.</p>
<!-- START CODE "c8815_157" -->
<a id="c8815_157"></a><blockquote class="code"><p class="quoted">
&quot;The Fourth Body&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8816_157" -->
<a id="c8816_157"></a><blockquote class="code"><p class="quoted">
A jotter is a kind of thing. A jotter has an external file called the text file. A jotter can be fresh or used. A jotter is usually fresh. A jotter has a text called the heading.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8817_157" -->
<a id="c8817_157"></a><blockquote class="code"><p class="quoted">
The currently erased jotter is an object that varies.
<br />To erase (pad - a jotter):
<br />&#160;&#160;&#160;&#160;now the currently erased jotter is the pad;
<br />&#160;&#160;&#160;&#160;write &quot;[heading of the currently erased jotter][paragraph break]&quot; to the text file of the pad;
<br />&#160;&#160;&#160;&#160;now the pad is fresh.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8818_157" -->
<a id="c8818_157"></a><blockquote class="code"><p class="quoted">
To write in (pad - a jotter):
<br />&#160;&#160;&#160;&#160;append &quot;[the time of day]: [topic understood][line break]&quot; to the text file of the pad;
<br />&#160;&#160;&#160;&#160;now the pad is used.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8819_157" -->
<a id="c8819_157"></a><blockquote class="code"><p class="quoted">
To read (pad - a jotter):
<br />&#160;&#160;&#160;&#160;say &quot;You read: [paragraph break][text of the text file of the pad]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>This is all as might be expected, except perhaps for the business of the &quot;currently erased jotter&quot;. Why copy &quot;pad&quot; into this - why not simply write &quot;[heading of the pad]&quot;? The answer is that &quot;pad&quot; is a temporary &quot;let&quot; value, and cannot be used inside other phrases, such as the &quot;write ... to ...&quot; phrase.</p>
<p>We want to erase any jotters when play begins, as otherwise text left over from any previous games will still be visible:</p>
<!-- START CODE "c8820_157" -->
<a id="c8820_157"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;repeat with pad running through jotters:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;erase the pad.
</p></blockquote>
<!-- END CODE -->
<p>Now we need to create rules to allow the player to control reading, writing and erasing. Reading we will handle with the ordinary examining action, but we create new actions for writing and erasing. A nice little trick allows WRITE WHATEVER to default to writing WHATEVER in a notebook being carried.</p>
<!-- START CODE "c8821_157" -->
<a id="c8821_157"></a><blockquote class="code"><p class="quoted">
Instead of examining a used jotter (called the pad):
<br />&#160;&#160;&#160;&#160;read the pad.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8822_157" -->
<a id="c8822_157"></a><blockquote class="code"><p class="quoted">
Instead of examining a fresh jotter (called the pad):
<br />&#160;&#160;&#160;&#160;say &quot;There is nothing of note in [the pad].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8823_157" -->
<a id="c8823_157"></a><blockquote class="code"><p class="quoted">
Understand &quot;write [text] in [something preferably held]&quot; as writing it in. Understand &quot;write [text]&quot; as writing it in. Writing it in is an action applying to a topic and one thing. Rule for supplying a missing second noun while writing: if a jotter (called the pad) is carried, now the second noun is the pad; otherwise say &quot;You will have to specify what to write that it.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8824_157" -->
<a id="c8824_157"></a><blockquote class="code"><p class="quoted">
Check writing it in:
<br />&#160;&#160;&#160;&#160;if the second noun is not a jotter, say &quot;It would be better to write in a notebook.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8825_157" -->
<a id="c8825_157"></a><blockquote class="code"><p class="quoted">
Carry out writing it in:
<br />&#160;&#160;&#160;&#160;write in the second noun.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8826_157" -->
<a id="c8826_157"></a><blockquote class="code"><p class="quoted">
Report writing it in:
<br />&#160;&#160;&#160;&#160;say &quot;Under the current time, you write '[the topic understood]' into [the second noun].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8827_157" -->
<a id="c8827_157"></a><blockquote class="code"><p class="quoted">
Understand &quot;erase [something preferably held]&quot; as erasing. Erasing is an action applying to one carried thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8828_157" -->
<a id="c8828_157"></a><blockquote class="code"><p class="quoted">
Check erasing:
<br />&#160;&#160;&#160;&#160;if the noun is not a jotter, say &quot;It's hard to see how.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8829_157" -->
<a id="c8829_157"></a><blockquote class="code"><p class="quoted">
Carry out erasing:
<br />&#160;&#160;&#160;&#160;erase the noun.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8830_157" -->
<a id="c8830_157"></a><blockquote class="code"><p class="quoted">
Report erasing:
<br />&#160;&#160;&#160;&#160;say &quot;You scrub out all the entries in [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<p>That completes a general-purpose implementation of jotters, and we put it to use:</p>
<!-- START CODE "c8831_157" -->
<a id="c8831_157"></a><blockquote class="code"><p class="quoted">
The player carries a jotter called your notebook. The file of Player's Observations is called &quot;notebook&quot;. The text file of your notebook is the file of Player's Observations. The heading of your notebook is &quot;Observations in the Pottingham Green Case&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8832_157" -->
<a id="c8832_157"></a><blockquote class="code"><p class="quoted">
The Damp Hillside is a room. &quot;It is just after dawn: among the trees there is misty and pale blue light. [if Havers is in the location]The only saturated color in view is the orange-and-yellow jacket of [Detective Havers]. She is trying unsuccessfully to light a cigarette. [end if][paragraph break]The body itself is further down, closer to the bottom of the ravine. It would be foolish to speculate before seeing it, but the odds are that the corpse was rolled down after death. The ground is not steep enough for the fall itself to be deadly.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8833_157" -->
<a id="c8833_157"></a><blockquote class="code"><p class="quoted">
Detective Havers is a woman in the Damp Hillside. The description is &quot;She gives you a weak smile when you look at her: you know she hasn't slept more than three hours any of the last few nights.&quot; Havers is scenery.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8834_157" -->
<a id="c8834_157"></a><blockquote class="code"><p class="quoted">
Havers is carrying a jotter called Barbara's notebook. The file of Barbara's Observations is called &quot;barbara&quot;. The text file of Barbara's notebook is the file of Barbara's Observations. The heading of Barbara's notebook is &quot;I could murder a cup of tea&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8835_157" -->
<a id="c8835_157"></a><blockquote class="code"><p class="quoted">
The time of day is 6:32 AM.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8836_157" -->
<a id="c8836_157"></a><blockquote class="code"><p class="quoted">
Instead of examining your notebook when your notebook is fresh:
<br />&#160;&#160;&#160;&#160;say &quot;Your notebook is blank. Back in the office, of course, there are a stack of others. But you brought a fresh notebook in a kind of weary hope. You're going to pretend, just for now, that this body might be unrelated to the graphic string of murders you're already investigating.&quot;
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "444: The Fifth Body" "e142" -->
<a id="e142"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e142" class="eglink"><b>444</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e142" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">The Fifth Body</span></b></a><br />An expansion on the notebook, allowing the player somewhat more room in which to type his recorded remark.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_9.html#e142"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example142">
<p>The implementation here is much like that of the previous example, except that we allow the player to write his notebook input as a separate command, leading to an exchange such as</p>
<!-- START CODE "c8837_142" -->
<a id="c8837_142"></a><blockquote class="code"><p class="quoted">
&gt;write in my notebook
<br />You open your notebook and prepare to write in it.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8838_142" -->
<a id="c8838_142"></a><blockquote class="code"><p class="quoted">
&gt;&gt;Am beginning to think that HT and BGG are in this together.
<br />You finish writing and fold your notebook away.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8839_142" -->
<a id="c8839_142"></a><blockquote class="code"><p class="quoted">
&gt;read my notebook
<br />You read:
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8840_142" -->
<a id="c8840_142"></a><blockquote class="code"><p class="quoted">
Wednesday morning
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8841_142" -->
<a id="c8841_142"></a><blockquote class="code"><p class="quoted">
Am beginning to think that HT and BGG are in this together.
</p></blockquote>
<!-- END CODE -->
<p>The opening is much as before:</p>
<!-- START CODE "c8842_142" -->
<a id="c8842_142"></a><blockquote class="code"><p class="quoted">
&quot;The Fifth Body&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8843_142" -->
<a id="c8843_142"></a><blockquote class="code"><p class="quoted">
A jotter is a kind of thing. A jotter has an external file called the text file. A jotter can be fresh or used. A jotter is usually fresh. A jotter has a text called the heading.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8844_142" -->
<a id="c8844_142"></a><blockquote class="code"><p class="quoted">
The currently erased jotter is an object that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8845_142" -->
<a id="c8845_142"></a><blockquote class="code"><p class="quoted">
To erase (pad - a jotter):
<br />&#160;&#160;&#160;&#160;now the currently erased jotter is the pad;
<br />&#160;&#160;&#160;&#160;write &quot;[heading of the currently erased jotter][paragraph break]&quot; to the text file of the pad;
<br />&#160;&#160;&#160;&#160;now the pad is fresh.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8846_142" -->
<a id="c8846_142"></a><blockquote class="code"><p class="quoted">
To write in (pad - a jotter):
<br />&#160;&#160;&#160;&#160;append &quot;[the time of day]: [player's command][line break]&quot; to the text file of the pad;
<br />&#160;&#160;&#160;&#160;now the pad is used.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8847_142" -->
<a id="c8847_142"></a><blockquote class="code"><p class="quoted">
To read (pad - a jotter):
<br />&#160;&#160;&#160;&#160;say &quot;You read: [paragraph break][text of the text file of the pad]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8848_142" -->
<a id="c8848_142"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;repeat with pad running through jotters:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;erase the pad.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8849_142" -->
<a id="c8849_142"></a><blockquote class="code"><p class="quoted">
Instead of examining a used jotter (called the pad):
<br />&#160;&#160;&#160;&#160;read the pad.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8850_142" -->
<a id="c8850_142"></a><blockquote class="code"><p class="quoted">
Instead of examining a fresh jotter (called the pad):
<br />&#160;&#160;&#160;&#160;say &quot;There is nothing of note in [the pad].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8851_142" -->
<a id="c8851_142"></a><blockquote class="code"><p class="quoted">
Target jotter is an object that varies. The target jotter is usually nothing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8852_142" -->
<a id="c8852_142"></a><blockquote class="code"><p class="quoted">
Understand &quot;write in [something preferably held]&quot; as writing in. Writing in is an action applying to one thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8853_142" -->
<a id="c8853_142"></a><blockquote class="code"><p class="quoted">
Check writing in:
<br />&#160;&#160;&#160;&#160;if the noun is not a jotter, say &quot;It would be better to write in a notebook.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8854_142" -->
<a id="c8854_142"></a><blockquote class="code"><p class="quoted">
Carry out writing in:
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;&gt;&gt;&quot;;
<br />&#160;&#160;&#160;&#160;now the target jotter is the noun.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8855_142" -->
<a id="c8855_142"></a><blockquote class="code"><p class="quoted">
Report writing in:
<br />&#160;&#160;&#160;&#160;say &quot;You open [the noun] and prepare to write in it.&quot;
</p></blockquote>
<!-- END CODE -->
<p>Now what happens is that the player, having typed WRITE IN NOTEBOOK, will be faced with a &quot;&gt;&gt;&quot; prompt instead of the usual &quot;&gt;&quot;: a sign that the input mode has changed.</p>
<p>The next code is to react to reading a command. Whatever the player types at the &gt;&gt; prompt when the target jotter is set will now be recorded in the notebook, though with a character limit of about 60-100 characters depending on how much upper-case and punctuation he uses. (There are ways to lift the character length restriction as well, but they would take us into deeper waters.)</p>
<!-- START CODE "c8856_142" -->
<a id="c8856_142"></a><blockquote class="code"><p class="quoted">
After reading a command when target jotter is a jotter:
<br />&#160;&#160;&#160;&#160;now the command prompt is &quot;&gt;&quot;;
<br />&#160;&#160;&#160;&#160;write in target jotter;
<br />&#160;&#160;&#160;&#160;now target jotter is used;
<br />&#160;&#160;&#160;&#160;say &quot;You finish writing and fold your notebook away.&quot;;
<br />&#160;&#160;&#160;&#160;now the target jotter is nothing;
<br />&#160;&#160;&#160;&#160;reject the player's command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8857_142" -->
<a id="c8857_142"></a><blockquote class="code"><p class="quoted">
Understand &quot;erase [something preferably held]&quot; as erasing. Erasing is an action applying to one carried thing.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8858_142" -->
<a id="c8858_142"></a><blockquote class="code"><p class="quoted">
Check erasing:
<br />&#160;&#160;&#160;&#160;if the noun is not a jotter, say &quot;It's hard to see how.&quot; instead.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8859_142" -->
<a id="c8859_142"></a><blockquote class="code"><p class="quoted">
Carry out erasing:
<br />&#160;&#160;&#160;&#160;erase the noun.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8860_142" -->
<a id="c8860_142"></a><blockquote class="code"><p class="quoted">
Report erasing:
<br />&#160;&#160;&#160;&#160;say &quot;You scrub out all the entries in [the noun].&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8861_142" -->
<a id="c8861_142"></a><blockquote class="code"><p class="quoted">
The player carries a jotter called your notebook. The file of Player's Observations is called &quot;notebook&quot;. The text file of your notebook is the file of Player's Observations. The heading of your notebook is &quot;Sunday Morning&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8862_142" -->
<a id="c8862_142"></a><blockquote class="code"><p class="quoted">
The Vestry is a room. &quot;[Havers] hangs back by the door: the forensics expert is not finished with a preliminary examination of the body. From here you can't see much, except that the expert has peeled back and laid to one side a liturgical vestment that someone at the church used to cover the corpse until the police came. What was once a cream silk with festive Easter embroidery is now stained with blood-colored handprints.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8863_142" -->
<a id="c8863_142"></a><blockquote class="code"><p class="quoted">
Detective Havers is a woman in the Vestry. The description is &quot;She looks glumly back. There's still a purple-ish bruise on her cheekbone from the disaster Thursday afternoon.&quot; Havers is scenery.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8864_142" -->
<a id="c8864_142"></a><blockquote class="code"><p class="quoted">
Havers is carrying a jotter called Barbara's notebook. The file of Barbara's Observations is called &quot;barbara&quot;. The text file of Barbara's notebook is the file of Barbara's Observations. The heading of Barbara's notebook is &quot;Sun. AM&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8865_142" -->
<a id="c8865_142"></a><blockquote class="code"><p class="quoted">
The time of day is 9:11 AM.
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
<!-- START EXAMPLE "445: Flathead News Network" "e334" -->
<a id="e334"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="WI_23.html#e334" class="eglink"><b>445</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23.html#e334" class="eglink"><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><img class="asterisk" alt="*" src="images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Flathead News Network</span></b></a><br />Using external files, together with a simple Unix script running in the background, to provide live news headlines inside a story file.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="RB_12.html#e334"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<div class="egpanel" id="example334">
<p>This example can only work if we have a separate program running in the background while the story file is being played, and as such it will only work if we set things up in a special way. Exactly how to do this will vary from platform to platform.</p>
<p>First, the source text for the Inform end of the communication line:</p>
<!-- START CODE "c8866_334" -->
<a id="c8866_334"></a><blockquote class="code"><p class="quoted">
&quot;Flathead News Network&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8867_334" -->
<a id="c8867_334"></a><blockquote class="code"><p class="quoted">
The file of RSS Requests is called &quot;rssrequest&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8868_334" -->
<a id="c8868_334"></a><blockquote class="code"><p class="quoted">
The file of RSS Responses (owned by project &quot;RSS-SCRIPT&quot;) is called &quot;rssreply&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8869_334" -->
<a id="c8869_334"></a><blockquote class="code"><p class="quoted">
To request (RSS feed address - text):
<br />&#160;&#160;&#160;&#160;mark the file of RSS Responses as not ready to read;
<br />&#160;&#160;&#160;&#160;write the RSS feed address to the file of RSS Requests.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8870_334" -->
<a id="c8870_334"></a><blockquote class="code"><p class="quoted">
Newsroom is a room. &quot;This is the secret nerve-centre of FNN, the Flathead News Network.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8871_334" -->
<a id="c8871_334"></a><blockquote class="code"><p class="quoted">
The BBC button is in the Newsroom. Instead of pushing the BBC button: say &quot;Bong!&quot;; request &quot;newsrss.bbc.co.uk/rss/newsonline_uk_edition/front_page/rss.xml&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8872_334" -->
<a id="c8872_334"></a><blockquote class="code"><p class="quoted">
The NASA button is in the Newsroom. Instead of pushing the NASA button: say &quot;Bang!&quot;; request &quot;www.nasa.gov/rss/breaking_news.rss&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8873_334" -->
<a id="c8873_334"></a><blockquote class="code"><p class="quoted">
The WHO button is in the Newsroom. Instead of pushing the WHO button: say &quot;Bing!&quot;; request &quot;http://www.doctorwhonews.net&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8874_334" -->
<a id="c8874_334"></a><blockquote class="code"><p class="quoted">
A screen is in the Newsroom.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c8875_334" -->
<a id="c8875_334"></a><blockquote class="code"><p class="quoted">
Instead of examining the screen:
<br />&#160;&#160;&#160;&#160;if ready to read the file of RSS Responses, say &quot;From the screen you read:[line break][text of the file of RSS Responses]&quot;;
<br />&#160;&#160;&#160;&#160;otherwise say &quot;The screen remains blank for now.&quot;
</p></blockquote>
<!-- END CODE -->
<p>As far as the story file is concerned, then, it sends a request down the communication line by writing the chosen RSS feed to the file named &quot;rssrequest&quot;, and expects a reply to come back down the line by being written to the file &quot;rssreply&quot;. However, the story file needs to expect that this might take some time. (Maybe forever, if there is no program responding, or if the Internet connection is not working.) The story file marks the &quot;rssreply&quot; file as not ready before it makes a request; if it subsequently finds that the file is now ready, that must mean that the other program has done the honours, and that all is well. In the mean time, &quot;The screen remains blank for now.&quot;</p>
<p>Now for the RSS-SCRIPT program. The following provides a crude but workable program suitable for running as a Perl script on a system which provides the standard Internet fetching program &quot;curl&quot;: Mac OS X, for instance. (If you have OS X, you can paste the following into a (Unix-format) text file called &quot;rss-script.pl&quot;, place it in your home folder, open the Terminal utility, type &quot;perl rss-script.pl&quot;, and then hide the Terminal window again.)</p>
<!-- START CODE "c8876_334" -->
<a id="c8876_334"></a><blockquote class="code"><p class="quoted">
for (;;) { # repeat forever:
<br />&#160;&#160;&#160;&#160;system(&quot;sleep 1&quot;); # wait 1 second
<br />&#160;&#160;&#160;&#160;open REQUEST, &quot;rssrequest.glkdata&quot; or next;
<br />&#160;&#160;&#160;&#160;# the request file has been detected:
<br />&#160;&#160;&#160;&#160;$header_line = &lt;REQUEST&gt;; # the header line
<br />&#160;&#160;&#160;&#160;$rss_feed = &lt;REQUEST&gt;; # the actual content - the RSS feed URL
<br />&#160;&#160;&#160;&#160;close REQUEST;
<br />&#160;&#160;&#160;&#160;if ($header_line =~ m/^\*/) { # if the request file is marked ready
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$rss = system(&quot;curl $rss_feed &gt;rawrss.txt&quot;); # download the RSS feed
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# read the RSS XML into a single Perl string:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;open RAWRSS, &quot;rawrss.txt&quot; or next;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$raw = &quot;&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;while ($nl = &lt;RAWRSS&gt;) {
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$raw = $raw.&quot; &quot;.$nl;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;close RAWRSS;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# look for the title and description of the first item:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ($raw =~ m/\&lt;item\&gt;\&lt;title.*?\&gt;(.*?)\&lt;\/title\&gt;.*?\&lt;description.*?\&gt;(.*?)\&lt;\/description\&gt;/) {
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# write the reply:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;open REPLY, &quot;&gt;rssreply.glkdata&quot; or next;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print REPLY &quot;* //RSS-SCRIPT// rssreply\n&quot;, $1, &quot;\n&quot;, $2, &quot;\n&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;close REPLY;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# request safely dealt with, so we can remove it:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;system(&quot;rm 'rssrequest.glkdata'&quot;);
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
<br />&#160;&#160;&#160;&#160;}
<br />}
</p></blockquote>
<!-- END CODE -->
</div>
<p></p>
<!-- END EXAMPLE -->
<hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
</body>
</html>
